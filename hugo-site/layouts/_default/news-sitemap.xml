{{- $newsPages := where .Site.RegularPages "Section" "news" -}}
{{- $recent := first 100 (where (sort $newsPages "Date" "desc") "Date" "gt" (now.AddDate 0 0 -2)) -}}
{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:news="http://www.google.com/schemas/sitemap-news/0.9">
  {{- range $recent }}
  <url>
    <loc>{{ replace .Permalink "http://" "https://" }}</loc>
    <news:news>
      <news:publication>
        <news:name>{{ $.Site.Title | htmlEscape }}</news:name>
        <news:language>{{ .Lang | default "en" }}</news:language>
      </news:publication>
      <news:publication_date>{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}</news:publication_date>
      <news:title>{{ .Title | htmlEscape }}</news:title>
    </news:news>
  </url>
  {{- end }}
</urlset>
