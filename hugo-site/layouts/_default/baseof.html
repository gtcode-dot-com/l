<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ if .IsHome }}{{ .Site.Title }} - {{ .Site.Params.description }}{{ else }}{{ .Title }} · {{ .Site.Title }}{{ end }}</title>
    {{ $enableMath := or .Params.math .Site.Params.math }}

    <!-- Meta tags -->
    {{ partial "fetch-article-meta.html" (dict "context" .) }}
    {{ $articleMeta := .Scratch.Get "_article_meta" }}
    {{ if not $articleMeta }}
      {{ $articleMetaMap := default (dict) (index .Site.Data "article_meta") }}
      {{ $articleMeta = index $articleMetaMap (trim .RelPermalink "/") }}
    {{ end }}
    {{ $pageDescription := .Site.Params.description }}
    {{ if .Description }}{{ $pageDescription = .Description }}{{ end }}
    {{ with .Params.meta_description }}{{ $pageDescription = . }}{{ end }}
    {{ with $articleMeta.meta_description }}{{ $pageDescription = . }}{{ end }}
    <meta name="description" content="{{ $pageDescription }}" />
    <meta name="author" content="{{ .Site.Params.author }}" />
    {{ $keywords := "" }}
    {{ with .Params.meta_keywords }}
      {{ if (reflect.IsSlice .) }}
        {{ $keywords = delimit . ", " }}
      {{ else }}
        {{ $keywords = . }}
      {{ end }}
    {{ end }}
    {{ if eq $keywords "" }}
      {{ with $articleMeta.keywords }}
        {{ $keywords = delimit . ", " }}
      {{ end }}
    {{ end }}
    {{ if ne $keywords "" }}
      <meta name="keywords" content="{{ $keywords }}" />
    {{ end }}
    <link rel="canonical" href="{{ .Permalink }}" />
    {{ $ogType := cond (eq .Section "news") "article" "website" }}
    {{ $ogImage := "/img/gtcode-core.svg" }}
    {{ with .Params.structured_data.main_image }}{{ $ogImage = . }}{{ end }}
    {{ with .Params.og_image }}{{ $ogImage = . }}{{ end }}
    {{ with $articleMeta.og_image }}{{ $ogImage = . }}{{ end }}
    <meta property="og:title" content="{{ .Title }} · {{ .Site.Title }}" />
    <meta property="og:description" content="{{ $pageDescription }}" />
    <meta property="og:type" content="{{ $ogType }}" />
    <meta property="og:url" content="{{ .Permalink }}" />
    <meta property="og:image" content="{{ $ogImage }}" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ .Title }} · {{ .Site.Title }}" />
    <meta name="twitter:description" content="{{ $pageDescription }}" />
    <meta name="twitter:image" content="{{ $ogImage }}" />

    <!-- CSS Reset -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-css-reset/1.4.0/reset.min.css" integrity="sha512-2vU3WXD4Y+PHLxnQM5ljaMmiuLMglTCcl1U3ZpXK9cZjmbRCSQJgP7outomRdwUJNiGXfVwNs3aYvP8HM4ljkA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="/css/main.css" />
    {{ if $enableMath }}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" />
    {{ end }}

    {{ partial "jsonld.html" . }}

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/img/gtcode-core.svg" />
  </head>
  <body>
    <header class="site-header">
      <div class="site-header-inner">
        <a href="/" class="site-logo">
          <img src="/img/gtcode-badge.svg" alt="GTCode mark" class="site-logo-mark" width="40" height="40" loading="lazy" decoding="async" />
          <span>{{ .Site.Title }}</span>
        </a>
        <button class="site-nav-toggle" type="button" aria-controls="primary-nav" aria-expanded="false">
          <span class="sr-only">Toggle primary navigation</span>
          <span class="site-nav-toggle-icon" aria-hidden="true">
            <span class="site-nav-toggle-bar"></span>
            <span class="site-nav-toggle-bar"></span>
            <span class="site-nav-toggle-bar"></span>
          </span>
          <span class="site-nav-toggle-label">Menu</span>
        </button>
        <nav class="site-nav" id="primary-nav" aria-label="Primary navigation" tabindex="-1">
          <a href="/" {{ if .IsHome }}class="active"{{ end }}>Home</a>
          <a href="/guides/" {{ if eq .Section "guides" }}class="active"{{ end }}>Guides</a>
          <a href="/repos/" {{ if eq .Section "repos" }}class="active"{{ end }}>Repos</a>
          <a href="/articles/" {{ if eq .Section "articles" }}class="active"{{ end }}>Articles</a>
          <div class="nav-dropdown">
            <a href="/news/" {{ if eq .Section "news" }}class="active"{{ end }}>News</a>
            <div class="nav-dropdown-menu">
              <a href="/news/ai-security/" {{ if eq .CurrentSection.Title "Ai Security" }}class="active"{{ end }}>AI Security</a>
              <a href="/news/ai-research/" {{ if eq .CurrentSection.Title "Ai Research" }}class="active"{{ end }}>AI Research</a>
              <a href="/news/comp-journalism/" {{ if eq .CurrentSection.Title "Comp Journalism" }}class="active"{{ end }}>Journalism</a>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <div class="site-nav-overlay" aria-hidden="true"></div>

    <main class="site-main">
      {{ partial "ai-agent-comment.html" . }}
      {{ block "main" . }}{{ end }}
    </main>

    <footer class="site-footer">
      <div class="site-footer-inner">
        <div class="footer-section">
          <h4>About</h4>
          <p class="text-muted">{{ .Site.Params.description }}</p>
        </div>
        <div class="footer-section">
          <h4>News</h4>
          <ul>
            <li><a href="/news/ai-security/">AI Security</a></li>
            <li><a href="/news/ai-research/">AI Research</a></li>
            <li><a href="/news/comp-journalism/">Computational Journalism</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Categories</h4>
          <ul>
            <li><a href="/guides/">Guides</a></li>
            <li><a href="/articles/">Articles</a></li>
            <li><a href="/repos/">Repos</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-copyright">
        &copy; {{ now.Format "2006" }}&nbsp;<a href="/">{{ .Site.Title }}</a>. Powered by GCMS.
      </div>
    </footer>
    {{ if $enableMath }}
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
    {{ end }}
    {{ if or (.Store.Get "hasMermaid") (.Page.Store.Get "hasMermaid") }}
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs" type="module"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        if (window.mermaid) {
          window.mermaid.initialize({
            startOnLoad: true,
            theme: "dark",
            securityLevel: "loose"
          });
        }
      });
    </script>
    {{ end }}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const body = document.body;
        const toggle = document.querySelector(".site-nav-toggle");
        const nav = document.getElementById("primary-nav");
        const overlay = document.querySelector(".site-nav-overlay");

        if (!toggle || !nav) {
          return;
        }

        const mobileQuery = window.matchMedia("(max-width: 960px)");

        const closeNav = function () {
          if (!body.classList.contains("nav-open")) {
            return false;
          }
          body.classList.remove("nav-open");
          toggle.setAttribute("aria-expanded", "false");
          return true;
        };

        const openNav = function () {
          if (body.classList.contains("nav-open")) {
            return;
          }
          body.classList.add("nav-open");
          toggle.setAttribute("aria-expanded", "true");
          const firstLink = nav.querySelector("a");
          if (firstLink) {
            firstLink.focus();
          }
        };

        body.classList.add("nav-ready");

        toggle.addEventListener("click", function () {
          if (body.classList.contains("nav-open")) {
            closeNav();
          } else {
            openNav();
          }
        });

        if (overlay) {
          overlay.addEventListener("click", closeNav);
        }

        nav.addEventListener("click", function (event) {
          if (event.target.closest("a") && mobileQuery.matches) {
            closeNav();
          }
        });

        document.addEventListener("keyup", function (event) {
          if (event.key === "Escape" && closeNav()) {
            toggle.focus();
          }
        });

        const mq = window.matchMedia("(min-width: 961px)");
        const mqHandler = function (event) {
          if (event.matches) {
            closeNav();
          }
        };

        if (mq.addEventListener) {
          mq.addEventListener("change", mqHandler);
        } else if (mq.addListener) {
          mq.addListener(mqHandler);
        }
      });
    </script>
  </body>
</html>
