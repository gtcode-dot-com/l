{{- $httpsPermalink := replace .Permalink "http://" "https://" -}}
{{- $language := .Site.LanguageCode | default "en-us" -}}
{{- $description := .Description | default (.Site.Params.description | default .Site.Title) -}}
{{- $pages := .Pages -}}
{{- if .IsHome -}}
  {{- $pages = .Site.RegularPages -}}
{{- end -}}
{{- $limit := site.Config.Services.RSS.Limit | default -1 -}}
{{- if ge $limit 0 -}}
  {{- $pages = first $limit $pages -}}
{{- end -}}
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>{{ .Title }}</title>
    <link>{{ $httpsPermalink }}</link>
    <description>{{ htmlEscape $description }}</description>
    <generator>Hugo</generator>
    <language>{{ $language }}</language>
    <lastBuildDate>{{ now.UTC.Format "Mon, 02 Jan 2006 15:04:05 -0700" }}</lastBuildDate>
    <atom:link href="{{ $httpsPermalink }}" rel="self" type="application/rss+xml" />
    {{- range $pages }}
      {{- $itemPermalink := replace .Permalink "http://" "https://" -}}
      {{- $pubDate := .Date -}}
      {{- if $pubDate.IsZero }}{{ $pubDate = .PublishDate }}{{ end -}}
      {{- if $pubDate.IsZero }}{{ $pubDate = .Lastmod }}{{ end -}}
      {{- if $pubDate.IsZero }}{{ $pubDate = now }}{{ end -}}
      <item>
        <title>{{ htmlEscape .Title }}</title>
        <link>{{ $itemPermalink }}</link>
        <pubDate>{{ $pubDate.UTC.Format "Mon, 02 Jan 2006 15:04:05 -0700" }}</pubDate>
        <guid>{{ $itemPermalink }}</guid>
        <description>{{ .Summary | html }}</description>
      </item>
    {{- end }}
  </channel>
</rss>
