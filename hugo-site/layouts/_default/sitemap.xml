{{- $base := strings.TrimSuffix "/" .Site.BaseURL -}}
{{- $siteLastMod := .Site.Lastmod -}}
{{- $siteLastModString := "" -}}
{{- if not ($siteLastMod.IsZero) -}}
  {{- $siteLastModString = $siteLastMod.Format "2006-01-02" -}}
{{- else -}}
  {{- $siteLastModString = now.Format "2006-01-02" -}}
{{- end -}}
{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{- /* Static assets that need explicit inclusion */ -}}
  {{- $staticEntries := slice
      (dict "loc" (printf "%s/investigation/" $base) "changefreq" "yearly" "priority" 0.85 "lastmod" "2025-08-20")
      (dict "loc" (printf "%s/investigation/exhibit-a-federal-intervention-hawaii/" $base) "changefreq" "yearly" "priority" 0.85 "lastmod" "2025-08-20")
      (dict "loc" (printf "%s/investigation/hawaii-institutional-capture/" $base) "changefreq" "yearly" "priority" 0.85 "lastmod" "2025-08-13")
      (dict "loc" (printf "%s/investigation/hawaii-justice-system-wilson-loo/" $base) "changefreq" "yearly" "priority" 0.80 "lastmod" "2025-07-13")
      (dict "loc" (printf "%s/papers/ResearchProposal-ChiralNarrativeSynthesis_20250617.pdf" $base) "changefreq" "yearly" "priority" 0.70 "lastmod" "2025-07-30")
    -}}
  {{- range $static := $staticEntries }}
  <url>
    <loc>{{- $static.loc -}}</loc>
    <lastmod>{{- or $static.lastmod $siteLastModString -}}</lastmod>
    <changefreq>{{- $static.changefreq | default "monthly" -}}</changefreq>
    <priority>{{- printf "%.2f" (float ($static.priority | default 0.50)) -}}</priority>
  </url>
  {{- end }}

  {{- range sort .Data.Pages "RelPermalink" "asc" }}
    {{- $lastmod := .Lastmod -}}
    {{- if $lastmod.IsZero }}{{ $lastmod = .PublishDate }}{{ end -}}
    {{- if $lastmod.IsZero }}{{ $lastmod = .Date }}{{ end -}}
    {{- if $lastmod.IsZero }}{{ $lastmod = $siteLastMod }}{{ end -}}
    {{- if $lastmod.IsZero }}{{ $lastmod = now }}{{ end -}}
    {{- $changefreq := .Sitemap.ChangeFreq -}}
    {{- if not $changefreq }}{{ $changefreq = "monthly" }}{{ end -}}
    {{- $priority := 0.50 -}}
    {{- $rawPriority := .Sitemap.Priority -}}
    {{- if and (ne $rawPriority nil) (ge (float $rawPriority) 0) }}
      {{- $priority = float $rawPriority -}}
    {{- end -}}
  <url>
    <loc>{{- printf "%s%s" $base .RelPermalink -}}</loc>
    {{- if not ($lastmod.IsZero) }}
    <lastmod>{{- $lastmod.Format "2006-01-02" -}}</lastmod>
    {{- end }}
    <changefreq>{{- $changefreq -}}</changefreq>
    <priority>{{- printf "%.2f" $priority -}}</priority>
  </url>
  {{- end }}
</urlset>
