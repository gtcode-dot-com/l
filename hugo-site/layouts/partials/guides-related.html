{{- $ctx := . -}}
{{- $nav := index .Site.Data "guides_nav" -}}
{{- if $nav -}}
  {{- $pillars := or (index $nav "pillars") (slice) -}}
  {{- $currentPillar := dict -}}
  {{- range $pillar := $pillars -}}
    {{- $pillarPage := site.GetPage $pillar.contentPath -}}
    {{- if and $pillarPage (strings.HasPrefix $ctx.RelPermalink $pillarPage.RelPermalink) -}}
      {{- $currentPillar = $pillar -}}
    {{- end -}}
  {{- end -}}
  {{- $suggestions := slice -}}
  {{- range $pillar := $pillars -}}
    {{- if and (ne $pillar $currentPillar) (lt (len $suggestions) 2) -}}
      {{- $pillarPage := site.GetPage $pillar.contentPath -}}
      {{- if $pillarPage -}}
        {{- $suggestions = $suggestions | append (dict "title" $pillar.title "description" $pillar.description "url" $pillarPage.RelPermalink "cta" $pillar.cta) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
  {{- if gt (len $suggestions) 0 -}}
    <section class="guides-related">
      <h2>Explore More CNS 2.0 Resources</h2>
      <div class="guides-related-grid">
        {{- range $card := $suggestions -}}
          <article class="guides-related-card">
            <p class="guides-related-eyebrow">From the library</p>
            <h3><a href="{{ $card.url }}">{{ $card.title }}</a></h3>
            <p>{{ $card.description }}</p>
            {{- with $card.cta -}}
              <a class="btn btn-link" href="{{ .url }}">{{ .text }}</a>
            {{- end -}}
          </article>
        {{- end -}}
      </div>
    </section>
  {{- end -}}
{{- end -}}
