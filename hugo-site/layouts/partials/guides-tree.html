{{- $page := .page -}}
{{- $current := .current -}}
{{- $depth := .depth | default 0 -}}
{{- $children := where ($page.Pages | default (slice)) "Params.nav_hide" "ne" true -}}
{{- if gt (len $children) 0 -}}
  <ul class="guides-nav-level guides-nav-level-{{ $depth }}">
    {{- range $child := $children.ByWeight -}}
      {{- $isSection := eq $child.Kind "section" -}}
      {{- $isActive := or (eq $child.RelPermalink $current.RelPermalink) (strings.HasPrefix $current.RelPermalink $child.RelPermalink) -}}
      <li class="guides-nav-item {{ if $isActive }}is-active{{ end }}">
        <a href="{{ $child.RelPermalink }}">{{ $child.LinkTitle | default $child.Title }}</a>
        {{- if $isSection -}}
          {{- partial "guides-tree.html" (dict "page" $child "current" $current "depth" (add $depth 1)) -}}
        {{- end -}}
      </li>
    {{- end -}}
  </ul>
{{- end -}}
