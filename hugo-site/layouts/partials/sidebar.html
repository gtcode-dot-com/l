<!-- hugo-site/layouts/partials/sidebar.html -->
<aside class="guide-sidebar">
    <nav class="guide-nav">
        {{ $currentPage := . }}
        {{ $devGuide := .Site.GetPage "section" "guides/building-cns-2.0-developers-guide" }}
        {{ $researchGuide := .Site.GetPage "section" "guides/cns-2.0-research-roadmap" }}
        {{ $theoryPage := .Site.GetPage "section" "guides/cns-2.0-research-roadmap/theoretical-foundations" }}
        {{ $ethicsPage := .Site.GetPage "section" "guides/cns-2.0-research-roadmap/ethics" }}
        {{ $blueprintPage := .Site.GetPage "section" "guides/cns-2.0-research-roadmap/blueprint" }}
        {{ $overviewPage := .Site.GetPage "section" "guides/cns-2.0-research-roadmap/overview" }}
        {{ $reposPage := .Site.GetPage "section" "repos" }}

        <!-- Determine active section -->
        {{ $isDevGuide := or (eq . $devGuide) (.IsDescendant $devGuide) }}
        {{ $isResearchGuide := or (eq . $researchGuide) (.IsDescendant $researchGuide) }}
        {{ $isTheory := or (eq . $theoryPage) (.IsDescendant $theoryPage) }}
        {{ $isEthics := or (eq . $ethicsPage) (.IsDescendant $ethicsPage) }}
        {{ $isBlueprint := or (eq . $blueprintPage) (.IsDescendant $blueprintPage) }}
        {{ $isOverview := or (eq . $overviewPage) (.IsDescendant $overviewPage) }}
        {{ $isRepos := or (eq . $reposPage) (.IsDescendant $reposPage) }}

        <!-- Section 1: Developer's Guide -->
        <div class="guide-menu-section">
            <h3 class="guide-menu-title">
                <a href="{{ $devGuide.RelPermalink }}" class="{{ if $isDevGuide }}active-guide{{ end }}">Developer's Guide</a>
            </h3>
            {{ if $isDevGuide }}
            <ul class="guide-menu-list">
                {{ range $devGuide.Pages.ByWeight }}
                <li class="guide-menu-item">
                    <a href="{{ .RelPermalink }}" class="{{ if eq . $currentPage }}active{{ end }}">{{ .Title }}</a>
                </li>
                {{ end }}
            </ul>
            {{ end }}
        </div>

        <!-- Section 2: Research Roadmap -->
        <div class="guide-menu-section">
            <h3 class="guide-menu-title">
                <a href="{{ $researchGuide.RelPermalink }}" class="{{ if $isResearchGuide }}active-guide{{ end }}">Research Roadmap</a>
            </h3>
            {{ if $isResearchGuide }}
            <ul class="guide-menu-list">
                {{ range $researchGuide.Pages.ByWeight }}
                    {{ $isCurrentSection := or (eq . $currentPage) ($currentPage.IsDescendant .) }}
                    <li class="guide-menu-item {{ if .IsSection }}is-section{{ end }}">
                        <a href="{{ .RelPermalink }}" class="{{ if and .IsSection $isCurrentSection }}active-section{{ end }} {{ if eq . $currentPage }}active{{ end }}">{{ .Title }}</a>
                        {{ if .IsSection }}
                            <ul class="guide-menu-list-nested">
                            {{ range .Pages.ByWeight }}
                                <li class="guide-menu-item">
                                    <a href="{{ .RelPermalink }}" class="{{ if eq . $currentPage }}active{{ end }}">{{ .Title }}</a>
                                </li>
                            {{ end }}
                            </ul>
                        {{ end }}
                    </li>
                {{ end }}
            </ul>
            {{ end }}
        </div>

        <div class="guide-menu-section">
            <h3 class="guide-menu-title">
                <a href="{{ $reposPage.RelPermalink }}" class="{{ if $isRepos }}active-guide{{ end }}">Repositories</a>
            </h3>
        </div>

    </nav>
</aside>
