{{- /*
  Dynamic News Navigation
  Loads categories from data/news_categories.json
  Falls back to empty if file doesn't exist
*/ -}}

{{- $newsData := .Site.Data.news_categories | default dict -}}
{{- $categories := $newsData.categories | default slice -}}

<div class="nav-dropdown">
  <a href="/news/" {{ if eq .Section "news" }}class="active"{{ end }}>News</a>

  {{- if gt (len $categories) 0 -}}
  <div class="nav-dropdown-menu">
    {{- range $categories -}}
      {{- $href := printf "/news/%s/" .slug -}}
      {{- $isActive := false -}}

      {{- /* Check if current page is in this category */ -}}
      {{- if and $.CurrentSection $.CurrentSection.File -}}
        {{- if eq $.CurrentSection.File.Dir (printf "news/%s/" .slug) -}}
          {{- $isActive = true -}}
        {{- end -}}
      {{- end -}}

      <a href="{{ $href }}" {{ if $isActive }}class="active"{{ end }}>
        {{- with .icon }}{{ . }} {{ end -}}
        {{- .title -}}
      </a>
    {{- end -}}
  </div>
  {{- else -}}
  {{- /* Fallback if no categories loaded */ -}}
  <div class="nav-dropdown-menu">
    <a href="/news/ai-security/">AI Security</a>
    <a href="/news/ai-research/">AI Research</a>
    <a href="/news/comp-journalism/">Journalism</a>
  </div>
  {{- end -}}
</div>
