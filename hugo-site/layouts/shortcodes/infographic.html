{{- $id := .Get "id" -}}
{{- $title := .Get "title" -}}
{{- $caption := .Get "caption" | default "" -}}
{{- $alt := .Get "alt" | default $title -}}

{{- /* Image mapping - maps panel IDs to Gemini image base names */ -}}
{{- $imageMap := dict
    "signal-to-self" "Gemini_Generated_Image_7f1ddi7f1ddi7f1d"
    "crystallizing-chaos" "Gemini_Generated_Image_9r7b089r7b089r7b"
    "dialectic-engine" "Gemini_Generated_Image_d54tfid54tfid54t"
    "gluing-belief" "Gemini_Generated_Image_gfmq7hgfmq7hgfmq"
    "surgical-epistemics" "Gemini_Generated_Image_mnm5o5mnm5o5mnm5"
    "persistent-self" "Gemini_Generated_Image_ozhcuiozhcuiozhc"
-}}

{{- $imageBase := index $imageMap $id -}}
{{- $imgPath := "/img/gemini/" -}}

<figure class="infographic-panel" id="panel-{{ $id }}">
  <picture>
    {{- /* XLarge for very wide screens (4K) */ -}}
    <source
      media="(min-width: 1600px)"
      srcset="{{ $imgPath }}{{ $imageBase }}_xlarge.jpg"
    >
    {{- /* Large for desktop */ -}}
    <source
      media="(min-width: 1200px)"
      srcset="{{ $imgPath }}{{ $imageBase }}_large.jpg"
    >
    {{- /* Medium for tablet */ -}}
    <source
      media="(min-width: 768px)"
      srcset="{{ $imgPath }}{{ $imageBase }}_medium.jpg"
    >
    {{- /* Small as default/mobile */ -}}
    <img
      src="{{ $imgPath }}{{ $imageBase }}_small.jpg"
      alt="{{ $alt }}"
      loading="lazy"
      class="infographic-image"
    >
  </picture>

  <figcaption>
    <div class="caption-header">
      <span class="panel-title">{{ $title }}</span>
    </div>
    {{- if $caption -}}
    <p class="panel-caption">{{ $caption | markdownify }}</p>
    {{- end -}}
  </figcaption>

  <div class="download-options">
    <span class="download-label">Download:</span>
    <div class="download-links">
      <a href="{{ $imgPath }}{{ $imageBase }}_xlarge.jpg" download title="4K resolution (3840px)">4K</a>
      <a href="{{ $imgPath }}{{ $imageBase }}_large.jpg" download title="Large (1920px)">Large</a>
      <a href="{{ $imgPath }}{{ $imageBase }}_medium.jpg" download title="Medium (1200px)">Medium</a>
      <a href="{{ $imgPath }}{{ $imageBase }}_small.jpg" download title="Small (640px)">Small</a>
    </div>
  </div>
</figure>
