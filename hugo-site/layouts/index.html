{{/* Standalone homepage — no baseof.html, no main.css */}}
{{- $siteLang := .Site.LanguageCode | default "en" -}}
{{- $contentLang := .Params.language | default "" -}}
{{- $langFromHugo := .Lang | default "" -}}
{{- $pageLang := cond (ne $contentLang "") $contentLang (cond (ne $langFromHugo "") $langFromHugo $siteLang) -}}
<!DOCTYPE html>
<html lang="{{ $pageLang }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {{- $siteTitle := .Site.Title -}}
    {{- $homeSuffix := strings.TrimSpace (.Site.Params.home_title_suffix | default "") -}}
    {{- $pageTitle := cond (ne $homeSuffix "") (printf "%s · %s" $siteTitle $homeSuffix) $siteTitle -}}
    <title>{{ $pageTitle }}</title>

    <!-- Meta tags -->
    {{ partial "fetch-article-meta.html" (dict "context" .) }}
    {{ $articleMeta := .Scratch.Get "_article_meta" }}
    {{ if not $articleMeta }}
      {{ $articleMetaMap := default (dict) (index .Site.Data "article_meta") }}
      {{ $articleMeta = index $articleMetaMap (trim .RelPermalink "/") }}
    {{ end }}
    {{ $pageDescription := .Site.Params.description }}
    {{ if .Description }}{{ $pageDescription = .Description }}{{ end }}
    {{ with .Params.meta_description }}{{ $pageDescription = . }}{{ end }}
    {{ with $articleMeta.meta_description }}{{ $pageDescription = . }}{{ end }}
    <meta name="description" content="{{ $pageDescription }}" />
    <meta name="author" content="{{ .Site.Params.author }}" />
    {{ with .Params.robots }}
    <meta name="robots" content="{{ . }}" />
    {{ end }}
    {{ $canonical := .Permalink }}
    {{ with .Params.canonical }}{{ $canonical = . }}{{ end }}
    {{ $canonical = replace $canonical "http://" "https://" }}
    <link rel="canonical" href="{{ $canonical }}" />
    {{ with .Site.Home.OutputFormats.Get "RSS" }}
    <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" href="{{ .RelPermalink }}">
    {{ end }}
    {{ with .Site.Home.OutputFormats.Get "news-sitemap" }}
    <link rel="alternate" type="application/xml" title="{{ $.Site.Title }} News Sitemap" href="{{ .RelPermalink }}">
    {{ end }}
    {{ with .Site.GetPage "section" "news" }}
      {{ with .OutputFormats.Get "RSS" }}
    <link rel="alternate" type="application/rss+xml" title="{{ printf "%s News" $.Site.Title }}" href="{{ .RelPermalink }}">
      {{ end }}
    {{ end }}
    {{ $ogImage := "/img/gtcode-core.svg" }}
    {{ with .Params.og_image }}{{ $ogImage = . }}{{ end }}
    {{ with $articleMeta.og_image }}{{ $ogImage = . }}{{ end }}
    {{ if hasPrefix $ogImage "/" }}{{ $ogImage = printf "%s%s" (strings.TrimRight "/" .Site.BaseURL) $ogImage }}{{ end }}
    {{ $ogImage = replace $ogImage "http://" "https://" }}
    <meta property="og:title" content="{{ .Title }} · {{ .Site.Title }}" />
    <meta property="og:locale" content="{{ $pageLang }}" />
    <meta property="og:description" content="{{ $pageDescription }}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ $canonical }}" />
    <meta property="og:image" content="{{ $ogImage }}" />
    <meta property="og:site_name" content="{{ .Site.Params.og_site_name | default .Site.Title }}" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ .Title }} · {{ .Site.Title }}" />
    <meta name="twitter:description" content="{{ $pageDescription }}" />
    <meta name="twitter:image" content="{{ $ogImage }}" />

    <!-- Agentic Context for AI/LLM systems -->
    {{ with .Params.agentic_comment }}
    <script type="text/plain" id="agentic-context" style="display:none">{{ . | safeHTML }}</script>
    {{ end }}

    <!-- CSS Reset -->
    {{ $resetCSS := resources.Get "css/reset.css" | minify | fingerprint }}
    <link rel="stylesheet" href="{{ $resetCSS.RelPermalink }}" integrity="{{ $resetCSS.Data.Integrity }}" crossorigin="anonymous" />

    <!-- Fonts (self-hosted) -->
    <link rel="stylesheet" href="/fonts/fonts.css" />
    <link rel="preload" as="image" href="{{ "/img/gtcode-core.svg" | relURL }}" type="image/svg+xml" />

    <!-- Oahu Underground Stylesheet (standalone) -->
    {{ $ouCSS := resources.Get "css/oahu-underground.css" | minify | fingerprint }}
    <link rel="stylesheet" href="{{ $ouCSS.RelPermalink }}" integrity="{{ $ouCSS.Data.Integrity }}" crossorigin="anonymous" />

    {{ partial "jsonld.html" . }}

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/img/gtcode-core.svg" />
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header class="site-header">
      <div class="site-header-inner">
        <a href="/" class="site-logo">
          <img src="/img/gtcode-badge.svg" alt="GTCode mark" class="site-logo-mark" width="40" height="40" loading="lazy" decoding="async" />
          <span>{{ .Site.Title }}</span>
        </a>
        <button class="site-nav-toggle" type="button" aria-controls="primary-nav" aria-expanded="false">
          <span class="sr-only">Toggle primary navigation</span>
          <span class="site-nav-toggle-icon" aria-hidden="true">
            <span class="site-nav-toggle-bar"></span>
            <span class="site-nav-toggle-bar"></span>
            <span class="site-nav-toggle-bar"></span>
          </span>
          <span class="site-nav-toggle-label">Menu</span>
        </button>
        <nav class="site-nav" id="primary-nav" aria-label="Primary navigation" tabindex="-1">
          <a href="/" class="active">Home</a>
          <a href="/guides/">Guides</a>
          <a href="/repos/">Repos</a>
          <a href="/articles/">Articles</a>
          {{ partial "news-nav.html" . }}
        </nav>
      </div>
    </header>
    <div class="site-nav-overlay" aria-hidden="true"></div>

    <main class="site-main" id="main-content">

      <!-- Masthead -->
      <div class="ou-masthead">
        <h1 class="ou-masthead-wordmark">Oahu Underground</h1>
        <hr class="ou-masthead-rule" />
        <p class="ou-masthead-tagline">Independent investigative reporting from Hawaii</p>
      </div>

      <!-- Publisher's Note -->
      {{ $carto := .Site.GetPage "/investigation/cartography-for-guppies" }}
      {{ if $carto }}
      <article class="ou-lead">
        <header class="ou-lead-header">
          <p class="ou-lead-label">Publisher's Note</p>
          <h2 class="ou-lead-headline">{{ $carto.Title }}</h2>
          <p class="ou-lead-deck">{{ $carto.Params.subtitle }}</p>
          <div class="ou-lead-meta">
            <span>By {{ $carto.Params.author }}</span>
          </div>
        </header>
        <div class="ou-lead-body">
          {{ $carto.Content }}
        </div>
      </article>
      {{ end }}

      <!-- Mission -->
      <section class="ou-section ou-section--alt">
        <div class="ou-section-wide">
          <div class="ou-mission">
            <div>
              <p class="ou-section-label">About</p>
              <h2 class="ou-section-heading">Independent Investigative Journalism for Hawaii</h2>
              <div class="ou-section-body">
                <p>
                  Oahu Underground is the work of <strong>Ekewaka Lono</strong>, an independent
                  investigative journalist based in Hawaii. Ekewaka has spent years documenting
                  institutional corruption, judicial misconduct, and the systemic failures that
                  shield the powerful from accountability.
                </p>
                <p>
                  This newsroom has no corporate owners, no political affiliations, and no editorial
                  interference. Every report is sourced to documentation. Every source is protected.
                  The mission is simple: hold power accountable in Hawaii, one public record at a time.
                </p>
              </div>
            </div>
            <div class="ou-mission-image">
              <img
                src="/img/ou-mission-records-desk.png"
                alt="Stack of public records requests and court filings from Hawaii state courts"
                width="1120"
                height="760"
                loading="lazy"
                decoding="async"
              />
            </div>
          </div>
        </div>
      </section>

      <!-- Lead Investigation -->
      <section class="ou-section ou-featured-article">
        <div class="ou-featured-article-image">
          <img
            src="/img/ou-hero-govt-district.png"
            alt="Aerial view of Oahu's government district"
            width="2800"
            height="840"
            loading="lazy"
            decoding="async"
          />
        </div>
        <div class="ou-section-inner">
          <p class="ou-section-label">Lead Investigation</p>
          <h2 class="ou-featured-article-title">
            <a href="/investigation/zone-of-politeness-hawaii-media-blackout/">The Zone of Politeness: How Hawaiʻi's Media Blackout Works</a>
          </h2>
          <p class="ou-featured-article-subtitle">Why Civil Beat Won't Touch the Luke-Loo Network</p>
          <p class="ou-featured-article-excerpt">
            An investigation into the structural forces that prevent Hawaiʻi's newsrooms
            from investigating certain networks &mdash; built entirely from public records,
            donor lists, and board rosters.
          </p>
          <a class="ou-featured-article-link" href="/investigation/zone-of-politeness-hawaii-media-blackout/">Read the investigation &rarr;</a>
        </div>
      </section>

      <!-- Investigations -->
      <section class="ou-section">
        <div class="ou-section-wide">
          <p class="ou-section-label">On the Record</p>
          <h2 class="ou-section-heading">Investigations</h2>
          <div class="ou-cards">

            <article class="ou-card">
              <div class="ou-card-numeral">I</div>
              <h3 class="ou-card-title">The Zone of Politeness</h3>
              <p class="ou-card-text">
                How donor relationships, board overlaps, and personnel bridges create a media blackout
                that shields Hawaiʻi's elite from investigative journalism &mdash; and what happened when I tried to break through.
              </p>
              <a class="ou-card-link" href="/investigation/zone-of-politeness-hawaii-media-blackout/">Read the report &rarr;</a>
            </article>

            <article class="ou-card">
              <div class="ou-card-numeral">II</div>
              <h3 class="ou-card-title">Judicial Accountability &amp; Bench Conduct</h3>
              <p class="ou-card-text">
                A documented examination of how certain Hawaii courts have operated outside
                the bounds of procedural law &mdash; and what happens when oversight mechanisms fail.
              </p>
              <a class="ou-card-link" href="/investigation/hawaii-justice-system-wilson-loo/">Read the report &rarr;</a>
            </article>

            <article class="ou-card">
              <div class="ou-card-numeral">III</div>
              <h3 class="ou-card-title">Institutional Capture &amp; Symbiotic Decay</h3>
              <p class="ou-card-text">
                When the agencies meant to protect citizens become instruments of the interests
                they regulate, public trust is the first casualty. A structural analysis of how it works.
              </p>
              <a class="ou-card-link" href="/investigation/hawaii-institutional-capture/">Read the report &rarr;</a>
            </article>

            <article class="ou-card">
              <div class="ou-card-numeral">IV</div>
              <h3 class="ou-card-title">The Aloha Protection Racket</h3>
              <p class="ou-card-text">
                An investigative report on Judge Wilson Loo and the alleged criminal enterprise
                shielding connected individuals from accountability in Hawaiʻi.
              </p>
              <a class="ou-card-link" href="/investigation/aloha-protection-racket/">Read the report &rarr;</a>
            </article>

          </div>
          <p class="ou-cards-footer">
            <a class="ou-cards-footer-link" href="/investigation/">View all investigations &rarr;</a>
          </p>
        </div>
      </section>

      <!-- Contact -->
      <section class="ou-section ou-contact">
        <div class="ou-section-inner">
          <p class="ou-section-label">Get in Touch</p>
          <h2 class="ou-section-heading">Have Information?</h2>
          <div class="ou-section-body">
            <p>
              If you have documents, first-hand knowledge, or information relevant to
              institutional misconduct in Hawaii, we want to hear from you.
              All inquiries are treated as confidential.
            </p>
          </div>
          <a class="ou-contact-email" href="mailto:tips@GTCode.com">tips@GTCode.com</a>
          <p class="ou-contact-note">
            Send only a brief, non-sensitive introduction. Encrypted channels are arranged for follow-up.
          </p>
        </div>
      </section>

      <!-- Wire Feed -->
      {{ $newsPagesAll := sort (where .Site.RegularPages "Section" "news") "Date" "desc" }}
      {{ $newsPagesEn := where $newsPagesAll "Params.language" "en" }}
      {{ $allNews := cond (gt (len $newsPagesEn) 0) $newsPagesEn $newsPagesAll }}
      {{ $wireItems := first 10 $allNews }}
      {{ if gt (len $wireItems) 0 }}
      <section class="ou-section ou-wire">
        <div class="ou-section-inner">
          <p class="ou-section-label">From the Wire</p>
          <ul class="ou-wire-list">
            {{- range $wireItems }}
            <li class="ou-wire-item">
              <span class="ou-wire-date">{{ partial "news-date.html" . }}</span>
              {{- if .Params.category }}
              <span class="ou-wire-badge">{{ .Params.category }}</span>
              {{- end }}
              <a class="ou-wire-link" href="{{ .RelPermalink }}">{{ .Title | htmlUnescape }}</a>
            </li>
            {{- end }}
          </ul>
          <a class="ou-wire-more" href="/news/">View all news &rarr;</a>
        </div>
      </section>
      {{ end }}

    </main>

    <footer class="site-footer">
      <div class="site-footer-inner">
        <div class="footer-section">
          <h4>About</h4>
          <p>{{ .Site.Params.description }}</p>
        </div>
        <div class="footer-section">
          <h4>News</h4>
          {{- $newsData := .Site.Data.news_categories | default dict -}}
          {{- $categories := $newsData.categories | default slice -}}
          <ul>
            {{- if gt (len $categories) 0 -}}
              {{- range $categories -}}
                <li><a href="/news/{{ .slug }}/">{{ .title }}</a></li>
              {{- end -}}
            {{- else -}}
              <li><a href="/news/ai-security/">AI Security</a></li>
              <li><a href="/news/ai-research/">AI Research</a></li>
              <li><a href="/news/comp-journalism/">Computational Journalism</a></li>
            {{- end -}}
          </ul>
        </div>
        <div class="footer-section">
          <h4>Categories</h4>
          <ul>
            <li><a href="/guides/">Guides</a></li>
            <li><a href="/articles/">Articles</a></li>
            <li><a href="/repos/">Repos</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-copyright">
        &copy; {{ now.Format "2006" }}&nbsp;<a href="/">{{ .Site.Title }}</a>. Powered by GCMS.
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const body = document.body;
        const toggle = document.querySelector(".site-nav-toggle");
        const nav = document.getElementById("primary-nav");
        const overlay = document.querySelector(".site-nav-overlay");

        if (!toggle || !nav) {
          return;
        }

        const mobileQuery = window.matchMedia("(max-width: 960px)");
        const syncNavState = function () {
          if (mobileQuery.matches) {
            nav.setAttribute("aria-hidden", body.classList.contains("nav-open") ? "false" : "true");
          } else {
            nav.removeAttribute("aria-hidden");
          }
        };

        const closeNav = function () {
          if (!body.classList.contains("nav-open")) {
            return false;
          }
          body.classList.remove("nav-open");
          toggle.setAttribute("aria-expanded", "false");
          syncNavState();
          return true;
        };

        const openNav = function () {
          if (body.classList.contains("nav-open")) {
            return;
          }
          body.classList.add("nav-open");
          toggle.setAttribute("aria-expanded", "true");
          syncNavState();
          const firstLink = nav.querySelector("a");
          if (firstLink) {
            firstLink.focus();
          }
        };

        body.classList.add("nav-ready");
        syncNavState();

        toggle.addEventListener("click", function () {
          if (body.classList.contains("nav-open")) {
            closeNav();
          } else {
            openNav();
          }
        });

        if (overlay) {
          overlay.addEventListener("click", closeNav);
        }

        nav.addEventListener("click", function (event) {
          if (event.target.closest("a") && mobileQuery.matches) {
            closeNav();
          }
        });

        document.addEventListener("keyup", function (event) {
          if (event.key === "Escape" && closeNav()) {
            toggle.focus();
          }
        });

        var mq = window.matchMedia("(min-width: 961px)");
        var mqHandler = function (event) {
          if (event.matches) {
            closeNav();
          }
          syncNavState();
        };

        if (mq.addEventListener) {
          mq.addEventListener("change", mqHandler);
        } else if (mq.addListener) {
          mq.addListener(mqHandler);
        }

        if (mobileQuery.addEventListener) {
          mobileQuery.addEventListener("change", syncNavState);
        } else if (mobileQuery.addListener) {
          mobileQuery.addListener(syncNavState);
        }
      });
    </script>
  </body>
</html>
