{{ define "main" }}
  {{ with .Content }}
    {{ . | safeHTML }}
  {{ end }}
  <!-- Hero Section -->
  {{- $hero := .Params.hero | default dict -}}
  <div class="hero hero-profile">
    <div class="hero-inner">
      <div class="hero-content">
        <p class="hero-eyebrow">{{ $hero.eyebrow | default "Ekewaka Lono" }}</p>
        <h1>{{ $hero.title | default "AI Engineering Consultant & Investigative Journalist" }}</h1>
        <p class="hero-location">{{ $hero.location | default "Oahu, Hawai'i · Founder, GTCode" }}</p>
        <p class="hero-lede">{{ $hero.lede | default "Bridging advanced technology and public truth through bespoke AI systems, accountability reporting, and Chiral Narrative Synthesis research." }}</p>
        {{- with $hero.highlights }}
        <ul class="hero-highlights">
          {{- range . }}
          <li>{{ . }}</li>
          {{- end }}
        </ul>
        {{- end }}
        {{- with $hero.ctas }}
        <div class="hero-actions">
          {{- range . }}
          <a class="btn btn-{{ .style | default "primary" }}" href="{{ .url }}">{{ .label }}</a>
          {{- end }}
        </div>
        {{- end }}
      </div>
      <div class="hero-art hero-art-photo">
        <div class="hero-art-glow"></div>
        <img src="/img/gtcode-core.svg" alt="GTCode signal glyph" loading="lazy" decoding="async" />
        {{- with $hero.art_link }}
        <a class="btn btn-secondary hero-dossier-link" href="{{ .url }}">{{ .label }}</a>
        {{- end }}
      </div>
    </div>
  </div>

  <!-- Core Missions -->
  <section class="section-header hero-follow">
    <h2 class="section-title">Core Missions at GTCode</h2>
    <p class="section-description">Consultancy services, investigative journalism, and computational truth-seeking that reinforce one another.</p>
  </section>

  {{- $missionData := index .Site.Data.home "mission" | default dict -}}
  {{- $missions := $missionData.missions | default slice -}}
  <div class="news-grid mission-grid">
    {{- range $missions }}
    <article class="card">
      <div class="card-meta">
        <span class="badge badge-category">{{ .badge }}</span>
      </div>
      <h3 class="card-title"><a href="{{ .title_url }}">{{ .title }}</a></h3>
      <p class="card-summary">{{ .summary }}</p>
      {{- with .features }}
      <ul class="card-list">
        {{- range . }}
        <li>{{ . }}</li>
        {{- end }}
      </ul>
      {{- end }}
      {{- with .ctas }}
      <div class="card-actions">
        {{- range . }}
        <a class="btn btn-{{ .style | default "secondary" }}"
           href="{{ .url }}"
           {{- if .target }} target="{{ .target }}"{{ end }}
           {{- if .rel }} rel="{{ .rel }}"{{ end }}>
          {{ .label }}
        </a>
        {{- end }}
      </div>
      {{- end }}
    </article>
    {{- end }}
  </div>

  <!-- Featured Investigation -->
  <section class="section-header" style="margin-top: 2rem;">
    <h2 class="section-title">Featured Report: The Aloha Protection Racket</h2>
    <p class="section-description">A legal and investigative dossier on Judge Wilson Loo, institutional capture inside Hawaii’s judiciary, and the federal remedies now in motion.</p>
  </section>

  <article class="card spotlight-panel">
    <div class="spotlight-text">
      <div class="card-meta">
        <span class="badge badge-category">Investigative Journalism</span>
      </div>
      <h3>The Architect, the Asset, and the System</h3>
      <p>December 2, 2022 marked the apex of a protection racket run directly from the bench. Judge Loo’s silent obstruction, sealed records, and HPD’s coordinated inaction now stand as evidence inside a federal criminal complaint.</p>
      <ul class="card-list">
        <li>Documented perjury coaching inside a Hawaii First Circuit courtroom</li>
        <li>Witness intimidation, narcotics distribution, and vehicular assault ignored by HPD</li>
        <li>Secure evidence archive including audio, filings, and annotated timelines</li>
      </ul>
      <div class="spotlight-actions">
        <a class="btn btn-primary" href="/investigation/hawaii-justice-system-wilson-loo/">Read the Wilson Loo Investigation →</a>
        <a class="btn btn-secondary" href="mailto:tips@gtcode.com">Request Secure Contact</a>
      </div>
      <p class="secure-note">Send only a non-sensitive introduction to tips@gtcode.com. Encrypted channels are arranged for follow-up.</p>
    </div>
    <div class="spotlight-media">
      <img src="/img/gtcode_mahalo.jpg" alt="Investigative journalism and community reporting in Hawaii" loading="lazy" decoding="async" />
    </div>
  </article>

  <!-- Latest News Section -->
  <section id="articles" class="section-header" style="margin-top: 2rem;">
    <h2 class="section-title">Latest News</h2>
    <p class="section-description">Daily briefs on AI security, research, and accountability reporting curated by the GTCode desk.</p>
  </section>

  {{/* Round-robin interleave news by category */}}
  {{ $newsPagesAll := sort (where .Site.RegularPages "Section" "news") "Date" "desc" }}
  {{ $newsPagesEn := where $newsPagesAll "Params.language" "en" }}
  {{ $allNews := cond (gt (len $newsPagesEn) 0) $newsPagesEn $newsPagesAll }}

  {{/* Group by category */}}
  {{ $byCategory := dict }}
  {{ range $allNews }}
    {{ $cat := .Params.category | default "uncategorized" }}
    {{ $existing := index $byCategory $cat | default slice }}
    {{ $byCategory = merge $byCategory (dict $cat ($existing | append .)) }}
  {{ end }}

  {{/* Find max length */}}
  {{ $maxLen := 0 }}
  {{ range $byCategory }}
    {{ $maxLen = cond (gt (len .) $maxLen) (len .) $maxLen }}
  {{ end }}

  {{/* Round-robin interleave */}}
  {{ $interleaved := slice }}
  {{ range $i := seq 0 $maxLen }}
    {{ range $cat, $pages := $byCategory }}
      {{ if ge (len $pages) (add $i 1) }}
        {{ $interleaved = $interleaved | append (index $pages $i) }}
      {{ end }}
    {{ end }}
  {{ end }}

  {{ $newsPaginator := .Paginate $interleaved }}
  {{ $newsPages := $newsPaginator.Pages }}
  <div class="news-grid">
    {{ range $newsPages }}
      <article class="card">
        {{ if .Params.category }}
          <div class="card-meta">
            <span class="badge badge-category">{{ .Params.category }}</span>
          </div>
        {{ end }}
        <h3 class="card-title">
          <a href="{{ .RelPermalink }}">{{ .Title | htmlUnescape }}</a>
        </h3>
        <div class="card-meta">
          {{ partial "news-date.html" . }}
          {{ with .Params.source_url }}
            <span>&bull;</span>
            <a href="{{ . }}" target="_blank" rel="noopener">Source</a>
          {{ end }}
        </div>
        {{ with .Summary }}
          {{ $clean := replace (replace . "" "") "" "" }}
          <p class="card-summary">{{ $clean | plainify | truncate 160 }}</p>
        {{ end }}
        <a class="btn btn-link" href="{{ .RelPermalink }}">Read article →</a>
      </article>
    {{ end }}
  </div>
  {{ partial "pagination.html" . }}
  {{ partial "news-itemlist.html" (dict "pages" $newsPages) }}
{{ end }}
