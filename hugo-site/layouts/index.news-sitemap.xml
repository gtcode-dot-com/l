{{- $normalizedBase := replace .Site.BaseURL "http://" "https://" -}}
{{- $base := strings.TrimSuffix "/" $normalizedBase -}}
{{- $cutoff := now.AddDate 0 0 -2 -}}
{{- $recentNews := where .Site.RegularPages "Section" "news" -}}
{{- $recentNews = where $recentNews ".Date" "ge" $cutoff -}}
{{- $recentNews = first 100 $recentNews -}}
{{ printf "<?xml version=\"1.0\" encoding=\"utf-8\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:news="http://www.google.com/schemas/sitemap-news/0.9">
{{- range $recentNews }}
  {{- $publishDate := .PublishDate -}}
  {{- if $publishDate.IsZero }}{{ $publishDate = .Date }}{{ end -}}
  {{- $loc := printf "%s%s" $base .RelPermalink -}}
  {{- $loc = replace $loc "http://" "https://" -}}
  {{- $title := .Title -}}
  {{- $pubName := $.Site.Title | default "GTCode" -}}
  {{- $language := .Lang | default "en" -}}
  <url>
    <loc>{{ $loc }}</loc>
    <news:news>
      <news:publication>
        <news:name>{{ $pubName }}</news:name>
        <news:language>{{ $language }}</news:language>
      </news:publication>
      <news:publication_date>{{ $publishDate.Format "2006-01-02T15:04:05Z07:00" }}</news:publication_date>
      <news:title>{{ $title }}</news:title>
    </news:news>
  </url>
{{- end }}
</urlset>
