{{/* Standalone dark-themed article base — no main.css */}}
{{- $siteLang := .Site.LanguageCode | default "en" -}}
{{- $contentLang := .Params.language | default "" -}}
{{- $langFromHugo := .Lang | default "" -}}
{{- $pageLang := cond (ne $contentLang "") $contentLang (cond (ne $langFromHugo "") $langFromHugo $siteLang) -}}
<!DOCTYPE html>
<html lang="{{ $pageLang }}">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {{- $siteTitle := .Site.Title -}}
    <title>{{ .Title }} · {{ $siteTitle }}</title>

    <!-- Meta tags -->
    {{ partial "fetch-article-meta.html" (dict "context" .) }}
    {{ $articleMeta := .Scratch.Get "_article_meta" }}
    {{ if not $articleMeta }}
      {{ $articleMetaMap := default (dict) (index .Site.Data "article_meta") }}
      {{ $articleMeta = index $articleMetaMap (trim .RelPermalink "/") }}
    {{ end }}
    {{ $pageDescription := .Site.Params.description }}
    {{ if .Description }}{{ $pageDescription = .Description }}{{ end }}
    {{ with .Params.meta_description }}{{ $pageDescription = . }}{{ end }}
    {{ with $articleMeta.meta_description }}{{ $pageDescription = . }}{{ end }}
    <meta name="description" content="{{ $pageDescription }}" />
    <meta name="author" content="{{ .Site.Params.author }}" />
    {{ with .Params.robots }}
    <meta name="robots" content="{{ . }}" />
    {{ end }}
    {{ $canonical := .Permalink }}
    {{ with .Params.canonical }}{{ $canonical = . }}{{ end }}
    {{ $canonical = replace $canonical "http://" "https://" }}
    <link rel="canonical" href="{{ $canonical }}" />
    {{ with .Site.Home.OutputFormats.Get "RSS" }}
    <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" href="{{ .RelPermalink }}">
    {{ end }}
    {{ $ogImage := "/img/gtcode-core.svg" }}
    {{ with .Params.og_image }}{{ $ogImage = . }}{{ end }}
    {{ with $articleMeta.og_image }}{{ $ogImage = . }}{{ end }}
    <meta property="og:title" content="{{ .Title }} · {{ .Site.Title }}" />
    <meta property="og:locale" content="{{ $pageLang }}" />
    <meta property="og:description" content="{{ $pageDescription }}" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="{{ $canonical }}" />
    <meta property="og:image" content="{{ $ogImage }}" />
    <meta property="og:site_name" content="{{ .Site.Params.og_site_name | default .Site.Title }}" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{{ .Title }} · {{ .Site.Title }}" />
    <meta name="twitter:description" content="{{ $pageDescription }}" />
    <meta name="twitter:image" content="{{ $ogImage }}" />

    <!-- CSS Reset -->
    {{ $resetCSS := resources.Get "css/reset.css" | minify | fingerprint }}
    <link rel="stylesheet" href="{{ $resetCSS.RelPermalink }}" integrity="{{ $resetCSS.Data.Integrity }}" crossorigin="anonymous" />

    <!-- Fonts (self-hosted) -->
    <link rel="stylesheet" href="/fonts/fonts.css" />

    <!-- Oahu Underground Stylesheet (standalone dark theme) -->
    {{ $ouCSS := resources.Get "css/oahu-underground.css" | minify | fingerprint }}
    <link rel="stylesheet" href="{{ $ouCSS.RelPermalink }}" integrity="{{ $ouCSS.Data.Integrity }}" crossorigin="anonymous" />

    {{ partial "jsonld.html" . }}

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/img/gtcode-core.svg" />
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header class="site-header">
      <div class="site-header-inner">
        <a href="/" class="site-logo">
          <img src="/img/gtcode-badge.svg" alt="GTCode mark" class="site-logo-mark" width="40" height="40" loading="lazy" decoding="async" />
          <span>{{ .Site.Title }}</span>
        </a>
        <button class="site-nav-toggle" type="button" aria-controls="primary-nav" aria-expanded="false">
          <span class="sr-only">Toggle primary navigation</span>
          <span class="site-nav-toggle-icon" aria-hidden="true">
            <span class="site-nav-toggle-bar"></span>
            <span class="site-nav-toggle-bar"></span>
            <span class="site-nav-toggle-bar"></span>
          </span>
          <span class="site-nav-toggle-label">Menu</span>
        </button>
        <nav class="site-nav" id="primary-nav" aria-label="Primary navigation" tabindex="-1">
          <a href="/">Home</a>
          <a href="/guides/">Guides</a>
          <a href="/repos/">Repos</a>
          <a href="/articles/" class="active">Articles</a>
          {{ partial "news-nav.html" . }}
        </nav>
      </div>
    </header>
    <div class="site-nav-overlay" aria-hidden="true"></div>

    <main class="site-main" id="main-content">
      {{ block "main" . }}{{ end }}
    </main>

    <footer class="site-footer">
      <div class="site-footer-inner">
        <div class="footer-section">
          <h4>About</h4>
          <p>{{ .Site.Params.description }}</p>
        </div>
        <div class="footer-section">
          <h4>News</h4>
          {{- $newsData := .Site.Data.news_categories | default dict -}}
          {{- $categories := $newsData.categories | default slice -}}
          <ul>
            {{- if gt (len $categories) 0 -}}
              {{- range $categories -}}
                <li><a href="/news/{{ .slug }}/">{{ .title }}</a></li>
              {{- end -}}
            {{- else -}}
              <li><a href="/news/ai-security/">AI Security</a></li>
              <li><a href="/news/ai-research/">AI Research</a></li>
              <li><a href="/news/comp-journalism/">Computational Journalism</a></li>
            {{- end -}}
          </ul>
        </div>
        <div class="footer-section">
          <h4>Categories</h4>
          <ul>
            <li><a href="/guides/">Guides</a></li>
            <li><a href="/articles/">Articles</a></li>
            <li><a href="/repos/">Repos</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-copyright">
        &copy; {{ now.Format "2006" }}&nbsp;<a href="/">{{ .Site.Title }}</a>. Powered by GCMS.
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var body = document.body;
        var toggle = document.querySelector(".site-nav-toggle");
        var nav = document.getElementById("primary-nav");
        var overlay = document.querySelector(".site-nav-overlay");
        if (!toggle || !nav) return;
        var mobileQuery = window.matchMedia("(max-width: 960px)");
        var syncNavState = function () {
          if (mobileQuery.matches) {
            nav.setAttribute("aria-hidden", body.classList.contains("nav-open") ? "false" : "true");
          } else {
            nav.removeAttribute("aria-hidden");
          }
        };
        var closeNav = function () {
          if (!body.classList.contains("nav-open")) return false;
          body.classList.remove("nav-open");
          toggle.setAttribute("aria-expanded", "false");
          syncNavState();
          return true;
        };
        var openNav = function () {
          if (body.classList.contains("nav-open")) return;
          body.classList.add("nav-open");
          toggle.setAttribute("aria-expanded", "true");
          syncNavState();
          var firstLink = nav.querySelector("a");
          if (firstLink) firstLink.focus();
        };
        body.classList.add("nav-ready");
        syncNavState();
        toggle.addEventListener("click", function () {
          body.classList.contains("nav-open") ? closeNav() : openNav();
        });
        if (overlay) overlay.addEventListener("click", closeNav);
        nav.addEventListener("click", function (e) {
          if (e.target.closest("a") && mobileQuery.matches) closeNav();
        });
        document.addEventListener("keyup", function (e) {
          if (e.key === "Escape" && closeNav()) toggle.focus();
        });
        var mq = window.matchMedia("(min-width: 961px)");
        var mqHandler = function (e) { if (e.matches) closeNav(); syncNavState(); };
        if (mq.addEventListener) mq.addEventListener("change", mqHandler);
        else if (mq.addListener) mq.addListener(mqHandler);
        if (mobileQuery.addEventListener) mobileQuery.addEventListener("change", syncNavState);
        else if (mobileQuery.addListener) mobileQuery.addListener(syncNavState);
      });
    </script>
  </body>
</html>
