<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chapter 3: Multi-Component Critic Pipeline | Building CNS 2.0: A Developer&#39;s Guide</title>
    <meta name="description" content="Implementing transparent evaluation systems for grounding, logic, and novelty assessment">
    <meta name="author" content="CNS Development Team">
    
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">
    
    
    <link rel="stylesheet" href="/css/style.css?v=1753847786">
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    




    
    
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
    <div class="site-wrapper">
        
        <header class="site-header">
            <div class="container">
                <nav class="main-nav">
                    <div class="nav-brand">
                        <a href="/guides/building-cns-2.0-developers-guide/" class="brand-link">
                            <span class="brand-icon">üß†</span>
                            <span class="brand-text">Building CNS 2.0: A Developer&#39;s Guide</span>
                        </a>
                    </div>
                    
                    <div class="nav-menu">
                        <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
                            <i data-feather="menu"></i>
                        </button>
                        
                        <ul class="nav-list">
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-1-introduction/" class="nav-link ">
                                        Introduction
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-2-sno-foundations/" class="nav-link ">
                                        SNO Foundations
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-3-critic-pipeline/" class="nav-link ">
                                        Critic Pipeline
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-4-synthesis-engine/" class="nav-link ">
                                        Synthesis Engine
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-5-system-integration/" class="nav-link ">
                                        System Integration
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-6-complete-implementation/" class="nav-link ">
                                        Complete Implementation
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-7-dspy-integration/" class="nav-link ">
                                        DSPy Integration
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </header>

        
        <main class="site-main">
            <div class="container">
                
<article class="content-article">
    
    <header class="article-header">
        <div class="article-meta">
            <span class="article-weight">Chapter 3</span>
            <span class="article-separator">‚Ä¢</span>
            <time class="article-date">July 29, 2025</time>
        </div>
        
        <h1 class="article-title">Chapter 3: Multi-Component Critic Pipeline</h1>
        
        
        <p class="article-description">Implementing transparent evaluation systems for grounding, logic, and novelty assessment</p>
        
        
        
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 50.010000000000005%"></div>
            </div>
        </div>
    </header>

    
    <aside class="article-toc">
        <h3>Table of Contents</h3>
        <nav id="TableOfContents">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#the-problem-with-black-box-evaluation">The Problem with Black-Box Evaluation</a>
      <ul>
        <li><a href="#from-paper-to-code-the-mathematical-foundation">From Paper to Code: The Mathematical Foundation</a></li>
      </ul>
    </li>
    <li><a href="#implementing-the-specialized-critics">Implementing the Specialized Critics</a>
      <ul>
        <li><a href="#2-logic-critic-implementation">2. Logic Critic Implementation</a></li>
        <li><a href="#3-novelty-parsimony-critic-implementation">3. Novelty-Parsimony Critic Implementation</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </nav>
    </aside>

    
    <div class="article-content">
        <div class="guide-header">
    <a href="/" class="home-link">‚Üê Back to GTCode.com Homepage</a>
</div>
<h1 id="chapter-3-multi-component-critic-pipeline">Chapter 3: Multi-Component Critic Pipeline</h1>
<h2 id="the-problem-with-black-box-evaluation">The Problem with Black-Box Evaluation</h2>
<p>Traditional knowledge synthesis systems often rely on opaque &ldquo;oracle&rdquo; critics that provide scores without explanation. CNS 2.0 takes a fundamentally different approach by decomposing evaluation into transparent, specialized components that each assess distinct aspects of narrative quality.</p>
<p>The Multi-Component Critic Pipeline consists of three specialized critics:</p>
<ol>
<li><strong>Grounding Critic</strong> - Evaluates evidential support</li>
<li><strong>Logic Critic</strong> - Assesses structural coherence</li>
<li><strong>Novelty-Parsimony Critic</strong> - Balances innovation against complexity</li>
</ol>
<h3 id="from-paper-to-code-the-mathematical-foundation">From Paper to Code: The Mathematical Foundation</h3>
<p>The power of this pipeline comes from its transparent, component-based approach to calculating a final reward or trust score. The paper formalizes this in Section 2.2 with Equation (1).</p>
<blockquote>
<p><strong>From the Paper (Equation 1):</strong>
The final trust score $T$ and reward signal emerge from a weighted combination:</p></blockquote>
$$
\text{Reward}(\mathcal{S}) = \sum_{i \in \{G, L, N\}} w_i \cdot \text{Score}_i(\mathcal{S})
$$<blockquote>
<p>where $w_i$ are dynamically adjustable weights and the component scores are from the Grounding, Logic, and Novelty-Parsimony critics.</p></blockquote>
<p><strong>From Paper to Code:</strong></p>
<p>Our <code>CriticPipeline</code> class directly implements this weighted summation. Look at the <code>evaluate_sno</code> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># From CriticPipeline.evaluate_sno</span>
</span></span><span style="display:flex;"><span>total_weighted_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>total_weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> critic_type, critic <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>critics<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> critic<span style="color:#f92672">.</span>evaluate(sno, context)
</span></span><span style="display:flex;"><span>    total_weighted_score <span style="color:#f92672">+=</span> result<span style="color:#f92672">.</span>score <span style="color:#f92672">*</span> critic<span style="color:#f92672">.</span>weight
</span></span><span style="display:flex;"><span>    total_weight <span style="color:#f92672">+=</span> critic<span style="color:#f92672">.</span>weight
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>trust_score <span style="color:#f92672">=</span> total_weighted_score <span style="color:#f92672">/</span> total_weight <span style="color:#66d9ef">if</span> total_weight <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>
</span></span></code></pre></div><p>Here&rsquo;s the breakdown:</p>
<ul>
<li>The <code>for</code> loop iterates through each critic, which represents the summation ($\sum$).</li>
<li><code>result.score</code> is the $\text{Score}_i(\mathcal{S})$ for a specific critic (Grounding, Logic, or Novelty).</li>
<li><code>critic.weight</code> is the $w_i$ for that critic.</li>
<li><code>total_weighted_score</code> accumulates the <code>result.score * critic.weight</code> product for each critic.</li>
<li>Finally, we divide by <code>total_weight</code> to normalize the score, which becomes the SNO&rsquo;s final <code>trust_score</code> (<code>T</code>).</li>
</ul>
<p>The <code>adjust_weights</code> method allows for the dynamic adjustment of $w_i$ values, just as described in the paper.</p>
<h2 id="implementing-the-specialized-critics">Implementing the Specialized Critics</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Multi-Component Critic Pipeline Implementation
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">============================================
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Transparent, auditable evaluation of SNO quality
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> abc <span style="color:#f92672">import</span> ABC, abstractmethod
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Tuple, Optional, Any
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CriticResult</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Result from a critic evaluation with full transparency&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    score: float  <span style="color:#75715e"># Normalized score [0, 1]</span>
</span></span><span style="display:flex;"><span>    confidence: float  <span style="color:#75715e"># Confidence in the assessment [0, 1]</span>
</span></span><span style="display:flex;"><span>    explanation: str  <span style="color:#75715e"># Human-readable explanation</span>
</span></span><span style="display:flex;"><span>    evidence: Dict[str, Any]  <span style="color:#75715e"># Supporting evidence for the score</span>
</span></span><span style="display:flex;"><span>    sub_scores: Dict[str, float]  <span style="color:#75715e"># Breakdown of component scores</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CriticType</span>(Enum):
</span></span><span style="display:flex;"><span>    GROUNDING <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grounding&#34;</span>
</span></span><span style="display:flex;"><span>    LOGIC <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;logic&#34;</span>
</span></span><span style="display:flex;"><span>    NOVELTY <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;novelty&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseCritic</span>(ABC):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Abstract base class for all CNS 2.0 critics&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, critic_type: CriticType, weight: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>critic_type <span style="color:#f92672">=</span> critic_type
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>weight <span style="color:#f92672">=</span> weight
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>evaluation_count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>performance_history <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@abstractmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate</span>(self, sno: StructuredNarrativeObject, context: Optional[Dict] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> CriticResult:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Evaluate an SNO and return detailed results&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_weight</span>(self, new_weight: float):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Dynamically adjust critic weight based on context&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>weight <span style="color:#f92672">=</span> new_weight
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_statistics</span>(self) <span style="color:#f92672">-&gt;</span> Dict[str, Any]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Get performance statistics for this critic&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;type&#39;</span>: self<span style="color:#f92672">.</span>critic_type<span style="color:#f92672">.</span>value,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;weight&#39;</span>: self<span style="color:#f92672">.</span>weight,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;evaluations&#39;</span>: self<span style="color:#f92672">.</span>evaluation_count,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;avg_score&#39;</span>: np<span style="color:#f92672">.</span>mean([r[<span style="color:#e6db74">&#39;score&#39;</span>] <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>performance_history]) <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>performance_history <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;avg_confidence&#39;</span>: np<span style="color:#f92672">.</span>mean([r[<span style="color:#e6db74">&#39;confidence&#39;</span>] <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>performance_history]) <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>performance_history <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CriticPipeline</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Orchestrates multiple critics to produce comprehensive SNO evaluation&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>critics: Dict[CriticType, BaseCritic] <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>evaluation_history <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_critic</span>(self, critic: BaseCritic):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Add a critic to the pipeline&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>critics[critic<span style="color:#f92672">.</span>critic_type] <span style="color:#f92672">=</span> critic
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate_sno</span>(self, sno: StructuredNarrativeObject, context: Optional[Dict] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> Dict[str, Any]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Evaluate an SNO using all available critics&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        results <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        total_weighted_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        total_weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> critic_type, critic <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>critics<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>            result <span style="color:#f92672">=</span> critic<span style="color:#f92672">.</span>evaluate(sno, context)
</span></span><span style="display:flex;"><span>            results[critic_type<span style="color:#f92672">.</span>value] <span style="color:#f92672">=</span> result
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Accumulate weighted score</span>
</span></span><span style="display:flex;"><span>            total_weighted_score <span style="color:#f92672">+=</span> result<span style="color:#f92672">.</span>score <span style="color:#f92672">*</span> critic<span style="color:#f92672">.</span>weight
</span></span><span style="display:flex;"><span>            total_weight <span style="color:#f92672">+=</span> critic<span style="color:#f92672">.</span>weight
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Update critic performance history</span>
</span></span><span style="display:flex;"><span>            critic<span style="color:#f92672">.</span>performance_history<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;score&#39;</span>: result<span style="color:#f92672">.</span>score,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;confidence&#39;</span>: result<span style="color:#f92672">.</span>confidence
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            critic<span style="color:#f92672">.</span>evaluation_count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Compute final trust score</span>
</span></span><span style="display:flex;"><span>        trust_score <span style="color:#f92672">=</span> total_weighted_score <span style="color:#f92672">/</span> total_weight <span style="color:#66d9ef">if</span> total_weight <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Update SNO trust score</span>
</span></span><span style="display:flex;"><span>        sno<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">=</span> trust_score
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        evaluation_result <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;trust_score&#39;</span>: trust_score,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;critic_results&#39;</span>: results,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;weights_used&#39;</span>: {ct<span style="color:#f92672">.</span>value: c<span style="color:#f92672">.</span>weight <span style="color:#66d9ef">for</span> ct, c <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>critics<span style="color:#f92672">.</span>items()},
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;evaluation_id&#39;</span>: len(self<span style="color:#f92672">.</span>evaluation_history)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>evaluation_history<span style="color:#f92672">.</span>append(evaluation_result)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> evaluation_result
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">adjust_weights</span>(self, weight_updates: Dict[CriticType, float]):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Dynamically adjust critic weights based on context&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> critic_type, new_weight <span style="color:#f92672">in</span> weight_updates<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> critic_type <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>critics:
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>critics[critic_type]<span style="color:#f92672">.</span>update_weight(new_weight)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 1. Grounding Critic Implementation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">**</span>From Paper to Code: The Grounding Critic<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> The Grounding Critic evaluates how well a narrative<span style="color:#e6db74">&#39;s claims are supported by its evidence. Section 2.2 provides its formula:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$$</span>
</span></span><span style="display:flex;"><span>\text{Score}_G <span style="color:#f92672">=</span> \frac{<span style="color:#ae81ff">1</span>}{<span style="color:#f92672">|</span>V<span style="color:#f92672">|</span>}\sum_{v \<span style="color:#f92672">in</span> V} \max_{e \<span style="color:#f92672">in</span> \mathcal{E}} p(v<span style="color:#f92672">|</span>e)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$$</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> Here, <span style="color:#960050;background-color:#1e0010">$</span>p(v<span style="color:#f92672">|</span>e)<span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#f92672">is</span> the plausibility score of a claim <span style="color:#960050;background-color:#1e0010">`</span>v<span style="color:#960050;background-color:#1e0010">`</span> given a piece of evidence <span style="color:#960050;background-color:#1e0010">`</span>e<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">.</span> We will implement this using a pre<span style="color:#f92672">-</span>trained Natural Language Inference (NLI) model<span style="color:#f92672">.</span> An NLI model takes a premise (evidence) <span style="color:#f92672">and</span> a hypothesis (claim) <span style="color:#f92672">and</span> outputs probabilities <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#34;entailment,&#34;</span> <span style="color:#e6db74">&#34;neutral,&#34;</span> <span style="color:#f92672">and</span> <span style="color:#e6db74">&#34;contradiction.&#34;</span> We will use the <span style="color:#e6db74">&#34;entailment&#34;</span> probability <span style="color:#66d9ef">as</span> our <span style="color:#960050;background-color:#1e0010">$</span>p(v<span style="color:#f92672">|</span>e)<span style="color:#960050;background-color:#1e0010">$</span><span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">```</span>python
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GroundingCritic</span>(BaseCritic):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, weight: float, nli_model<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, nli_tokenizer<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, nli_model_name: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;microsoft/deberta-large-mnli&#34;</span>):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>(CriticType<span style="color:#f92672">.</span>GROUNDING, weight)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Use pre-loaded models if provided (for efficiency), otherwise load on demand</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> nli_model <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">and</span> nli_tokenizer <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>nli_model <span style="color:#f92672">=</span> nli_model
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>nli_tokenizer <span style="color:#f92672">=</span> nli_tokenizer
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> HAS_TRANSFORMERS:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">import</span> transformers
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>nli_tokenizer <span style="color:#f92672">=</span> transformers<span style="color:#f92672">.</span>AutoTokenizer<span style="color:#f92672">.</span>from_pretrained(nli_model_name)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>nli_model <span style="color:#f92672">=</span> transformers<span style="color:#f92672">.</span>AutoModelForSequenceClassification<span style="color:#f92672">.</span>from_pretrained(nli_model_name)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ImportError</span>(<span style="color:#e6db74">&#34;Transformers library is required for the GroundingCritic.&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Ensure we know the index for entailment</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>entailment_id <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>nli_model<span style="color:#f92672">.</span>config<span style="color:#f92672">.</span>label2id<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;entailment&#39;</span>, <span style="color:#ae81ff">2</span>)  <span style="color:#75715e"># Default to 2 if not found</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate</span>(self, sno: StructuredNarrativeObject, context: Optional[Dict] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> CriticResult:
</span></span><span style="display:flex;"><span>        claims <span style="color:#f92672">=</span> [data[<span style="color:#e6db74">&#39;claim&#39;</span>] <span style="color:#66d9ef">for</span> _, data <span style="color:#f92672">in</span> sno<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>nodes(data<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)]
</span></span><span style="display:flex;"><span>        evidence_contents <span style="color:#f92672">=</span> [item<span style="color:#f92672">.</span>content <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> sno<span style="color:#f92672">.</span>evidence_set]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> claims <span style="color:#f92672">or</span> <span style="color:#f92672">not</span> evidence_contents:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> CriticResult(<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#34;No claims or evidence to ground.&#34;</span>, {}, {})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        total_max_plausibility <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        sub_scores <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> claim <span style="color:#f92672">in</span> claims:
</span></span><span style="display:flex;"><span>            max_plausibility_for_claim <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Prepare NLI model inputs</span>
</span></span><span style="display:flex;"><span>            pairs <span style="color:#f92672">=</span> [(e, claim<span style="color:#f92672">.</span>content) <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> evidence_contents]
</span></span><span style="display:flex;"><span>            inputs <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>nli_tokenizer(pairs, return_tensors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pt&#39;</span>, padding<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, truncation<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
</span></span><span style="display:flex;"><span>                logits <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>nli_model(<span style="color:#f92672">**</span>inputs)<span style="color:#f92672">.</span>logits
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Get probabilities for entailment</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># We use softmax to convert logits to probabilities</span>
</span></span><span style="display:flex;"><span>            probabilities <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>softmax(logits, dim<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            entailment_probs <span style="color:#f92672">=</span> probabilities[:, self<span style="color:#f92672">.</span>entailment_id]<span style="color:#f92672">.</span>tolist()
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> entailment_probs:
</span></span><span style="display:flex;"><span>                max_plausibility_for_claim <span style="color:#f92672">=</span> max(entailment_probs)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            total_max_plausibility <span style="color:#f92672">+=</span> max_plausibility_for_claim
</span></span><span style="display:flex;"><span>            sub_scores[claim<span style="color:#f92672">.</span>claim_id] <span style="color:#f92672">=</span> max_plausibility_for_claim
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Score is the average of the max plausibility scores for each claim</span>
</span></span><span style="display:flex;"><span>        final_score <span style="color:#f92672">=</span> total_max_plausibility <span style="color:#f92672">/</span> len(claims) <span style="color:#66d9ef">if</span> claims <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> CriticResult(
</span></span><span style="display:flex;"><span>            score<span style="color:#f92672">=</span>final_score,
</span></span><span style="display:flex;"><span>            confidence<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>, <span style="color:#75715e"># Confidence can be improved with model-specific metrics</span>
</span></span><span style="display:flex;"><span>            explanation<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Average max NLI entailment score across </span><span style="color:#e6db74">{</span>len(claims)<span style="color:#e6db74">}</span><span style="color:#e6db74"> claims is </span><span style="color:#e6db74">{</span>final_score<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>,
</span></span><span style="display:flex;"><span>            evidence<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;claim_scores&#39;</span>: sub_scores},
</span></span><span style="display:flex;"><span>            sub_scores<span style="color:#f92672">=</span>sub_scores
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><h3 id="2-logic-critic-implementation">2. Logic Critic Implementation</h3>
<blockquote>
<p><strong>From Paper to Code: The Logic Critic</strong>
The Logic Critic assesses the structural coherence of the reasoning graph $G$. The paper specifies this as:</p></blockquote>
$$
\text{Score}_L = f_{\text{GNN}}(G; \theta)
$$<blockquote>
<p>Training a full Graph Neural Network (GNN) is a research project in itself. For our primitive, we will create a <em>functional proxy</em> for $f_{\text{GNN}}$ that uses graph-theoretic features to approximate logical coherence. This is a robust, explainable starting point for future GNN development. We&rsquo;ll check for orphaned claims, excessive branching (unfocused arguments), and graph density.</p></blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogicCritic</span>(BaseCritic):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, weight: float):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>(CriticType<span style="color:#f92672">.</span>LOGIC, weight)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate</span>(self, sno: StructuredNarrativeObject, context: Optional[Dict] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> CriticResult:
</span></span><span style="display:flex;"><span>        G <span style="color:#f92672">=</span> sno<span style="color:#f92672">.</span>reasoning_graph
</span></span><span style="display:flex;"><span>        num_nodes <span style="color:#f92672">=</span> G<span style="color:#f92672">.</span>number_of_nodes()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> num_nodes <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> CriticResult(<span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#34;Graph is too simple to assess logic.&#34;</span>, {}, {})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. Orphaned claims score (we want 0 orphans)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Nodes with in-degree 0 (excluding the root) are orphans</span>
</span></span><span style="display:flex;"><span>        orphaned_nodes <span style="color:#f92672">=</span> [n <span style="color:#66d9ef">for</span> n, d <span style="color:#f92672">in</span> G<span style="color:#f92672">.</span>in_degree() <span style="color:#66d9ef">if</span> d <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> n <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;root&#39;</span>]
</span></span><span style="display:flex;"><span>        orphan_penalty <span style="color:#f92672">=</span> len(orphaned_nodes) <span style="color:#f92672">/</span> (num_nodes <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        orphan_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> orphan_penalty
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. Coherence score (low branching is better)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Average out-degree measures branching. Lower is more focused.</span>
</span></span><span style="display:flex;"><span>        avg_out_degree <span style="color:#f92672">=</span> sum(d <span style="color:#66d9ef">for</span> _, d <span style="color:#f92672">in</span> G<span style="color:#f92672">.</span>out_degree()) <span style="color:#f92672">/</span> num_nodes
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Normalize: assume max reasonable branching is ~3</span>
</span></span><span style="display:flex;"><span>        coherence_score <span style="color:#f92672">=</span> max(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> (avg_out_degree <span style="color:#f92672">/</span> <span style="color:#ae81ff">3.0</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 3. Parsimony score (related to density)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># We prefer simpler, less dense graphs.</span>
</span></span><span style="display:flex;"><span>        density <span style="color:#f92672">=</span> nx<span style="color:#f92672">.</span>density(G)
</span></span><span style="display:flex;"><span>        parsimony_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> density
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Combine scores</span>
</span></span><span style="display:flex;"><span>        final_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">*</span> orphan_score <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.3</span> <span style="color:#f92672">*</span> coherence_score <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.2</span> <span style="color:#f92672">*</span> parsimony_score
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sub_scores <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;orphan_score&#39;</span>: orphan_score,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;coherence_score&#39;</span>: coherence_score,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;parsimony_score&#39;</span>: parsimony_score
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> CriticResult(
</span></span><span style="display:flex;"><span>            score<span style="color:#f92672">=</span>final_score,
</span></span><span style="display:flex;"><span>            confidence<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>, <span style="color:#75715e"># High confidence as it&#39;s deterministic</span>
</span></span><span style="display:flex;"><span>            explanation<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Logic score based on graph structure: </span><span style="color:#e6db74">{</span>final_score<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>            evidence<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;num_orphans&#39;</span>: len(orphaned_nodes), <span style="color:#e6db74">&#39;avg_out_degree&#39;</span>: avg_out_degree, <span style="color:#e6db74">&#39;density&#39;</span>: density},
</span></span><span style="display:flex;"><span>            sub_scores<span style="color:#f92672">=</span>sub_scores
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><h3 id="3-novelty-parsimony-critic-implementation">3. Novelty-Parsimony Critic Implementation</h3>
<blockquote>
<p><strong>From Paper to Code: The Novelty-Parsimony Critic</strong>
This critic balances innovation against complexity. The formula from Section 2.2 is:</p></blockquote>
$$
\text{Score}_N = \alpha \cdot \min_i \|H - H_i\|_2 - \beta \cdot \frac{|E_G|}{|V|}
$$<blockquote>
<p>The formula uses subtraction to create this balance. The first term rewards novelty (Euclidean distance to the nearest neighbor in the SNO population), and the second term, scaled by Œ≤, penalizes graph complexity (edge-to-node ratio). Since the result is not inherently bounded in [0, 1], our code calculates the raw score and then clamps the result to fit within our scoring framework.</p></blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NoveltyParsimonyCritic</span>(BaseCritic):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, weight: float, alpha: float, beta: float):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>(CriticType<span style="color:#f92672">.</span>NOVELTY, weight)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>alpha <span style="color:#f92672">=</span> alpha
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>beta <span style="color:#f92672">=</span> beta
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evaluate</span>(self, sno: StructuredNarrativeObject, context: Optional[Dict] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>) <span style="color:#f92672">-&gt;</span> CriticResult:
</span></span><span style="display:flex;"><span>        sno_population <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;sno_population&#39;</span>, [])
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. Calculate Novelty Term: Œ± * min_i ||H - H_i||</span>
</span></span><span style="display:flex;"><span>        population_embeddings <span style="color:#f92672">=</span> [s<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> sno_population <span style="color:#66d9ef">if</span> s<span style="color:#f92672">.</span>sno_id <span style="color:#f92672">!=</span> sno<span style="color:#f92672">.</span>sno_id <span style="color:#f92672">and</span> s<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> population_embeddings <span style="color:#f92672">or</span> sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            novelty_term <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>alpha <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.0</span> <span style="color:#75715e"># Max novelty if no population to compare to</span>
</span></span><span style="display:flex;"><span>            min_dist_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;N/A (first SNO)&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            distances <span style="color:#f92672">=</span> [np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">-</span> h) <span style="color:#66d9ef">for</span> h <span style="color:#f92672">in</span> population_embeddings]
</span></span><span style="display:flex;"><span>            min_distance <span style="color:#f92672">=</span> min(distances)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Normalize distance (max L2 is 2.0) and multiply by alpha</span>
</span></span><span style="display:flex;"><span>            novelty_term <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>alpha <span style="color:#f92672">*</span> (min_distance <span style="color:#f92672">/</span> <span style="color:#ae81ff">2.0</span>)
</span></span><span style="display:flex;"><span>            min_dist_str <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>min_distance<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. Calculate Parsimony Penalty Term: Œ≤ * (|E_G| / |V|)</span>
</span></span><span style="display:flex;"><span>        G <span style="color:#f92672">=</span> sno<span style="color:#f92672">.</span>reasoning_graph
</span></span><span style="display:flex;"><span>        num_nodes <span style="color:#f92672">=</span> G<span style="color:#f92672">.</span>number_of_nodes()
</span></span><span style="display:flex;"><span>        num_edges <span style="color:#f92672">=</span> G<span style="color:#f92672">.</span>number_of_edges()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        complexity_ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> num_nodes <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            complexity_ratio <span style="color:#f92672">=</span> num_edges <span style="color:#f92672">/</span> num_nodes
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        parsimony_penalty <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>beta <span style="color:#f92672">*</span> complexity_ratio
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 3. Calculate Final Score according to the formula</span>
</span></span><span style="display:flex;"><span>        raw_score <span style="color:#f92672">=</span> novelty_term <span style="color:#f92672">-</span> parsimony_penalty
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Clamp the score to be within the [0, 1] range</span>
</span></span><span style="display:flex;"><span>        final_score <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>clip(raw_score, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        explanation <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Score(</span><span style="color:#e6db74">{</span>final_score<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">) = NoveltyTerm(</span><span style="color:#e6db74">{</span>novelty_term<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">) - ParsimonyPenalty(</span><span style="color:#e6db74">{</span>parsimony_penalty<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">). Min dist: </span><span style="color:#e6db74">{</span>min_dist_str<span style="color:#e6db74">}</span><span style="color:#e6db74">.&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> CriticResult(
</span></span><span style="display:flex;"><span>            score<span style="color:#f92672">=</span>final_score,
</span></span><span style="display:flex;"><span>            confidence<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>,
</span></span><span style="display:flex;"><span>            explanation<span style="color:#f92672">=</span>explanation,
</span></span><span style="display:flex;"><span>            evidence<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;novelty_term&#39;</span>: novelty_term, <span style="color:#e6db74">&#39;parsimony_penalty&#39;</span>: parsimony_penalty, <span style="color:#e6db74">&#39;complexity_ratio&#39;</span>: complexity_ratio},
</span></span><span style="display:flex;"><span>            sub_scores<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;novelty_term&#39;</span>: novelty_term, <span style="color:#e6db74">&#39;parsimony_penalty&#39;</span>: parsimony_penalty}
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div>
    </div>

    
    <nav class="article-nav">
        <div class="nav-previous">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-4-synthesis-engine/" class="nav-link prev-link">
                    <i data-feather="arrow-right"></i>
                    <div class="nav-text">
                        <span class="nav-label">Next</span>
                        <span class="nav-title">Chapter 4: Generative Synthesis Engine</span>
                    </div>
                </a>
            
        </div>
        
        <div class="nav-next">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-2-sno-foundations/" class="nav-link next-link">
                    <div class="nav-text">
                        <span class="nav-label">Previous</span>
                        <span class="nav-title">Chapter 2: SNO Foundations</span>
                    </div>
                    <i data-feather="arrow-left"></i>
                </a>
            
        </div>
    </nav>

    
    <aside class="chapter-summary">
        <h3>Chapter Summary</h3>
        <div class="summary-content">
            
                <p>Implementing transparent evaluation through specialized critic components.</p>
                <ul>
                    <li>Multi-component critic architecture</li>
                    <li>Grounding, Logic, and Novelty critics</li>
                    <li>Transparent scoring and evaluation</li>
                </ul>
            
        </div>
    </aside>

    <footer>
        
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 50.010000000000005%"></div>
            </div>
            <span class="progress-text">3/7 chapters completed</span>
        </div>
    </footer>

</article>

            </div>
        </main>

        
        <footer class="site-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-text">
                        <p>&copy; 2025 <a href="https://GTCode.com/" class="footer-link">GTCode.com</a>. Educational content for CNS 2.0 implementation.</p>
                        <p>Based on <a target="_blank" 
                               rel="noopener noreferrer" href="/papers/ResearchProposal-ChiralNarrativeSynthesis_20250617_3.pdf" class="footer-link">CNS 2.0: A Practical Blueprint for Chiral Narrative Synthesis</a> research paper. (20250617 Version 3)</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    
    <script src="/js/navigation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
    
    <script>
        
        if (window.feather) feather.replace();
    </script>
</body>
</html>
