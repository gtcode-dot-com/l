<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chapter 5: System Integration | Building CNS 2.0: A Developer&#39;s Guide</title>
    <meta name="description" content="Combining all CNS 2.0 components into a working system with workflow management">
    <meta name="author" content="CNS Development Team">
    
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">
    
    
    <link rel="stylesheet" href="/css/style.css?v=1753845270">
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    




    
    
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
    <div class="site-wrapper">
        
        <header class="site-header">
            <div class="container">
                <nav class="main-nav">
                    <div class="nav-brand">
                        <a href="/guides/building-cns-2.0-developers-guide/" class="brand-link">
                            <span class="brand-icon">üß†</span>
                            <span class="brand-text">Building CNS 2.0: A Developer&#39;s Guide</span>
                        </a>
                    </div>
                    
                    <div class="nav-menu">
                        <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
                            <i data-feather="menu"></i>
                        </button>
                        
                        <ul class="nav-list">
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-1-introduction/" class="nav-link ">
                                        Introduction
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-2-sno-foundations/" class="nav-link ">
                                        SNO Foundations
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-3-critic-pipeline/" class="nav-link ">
                                        Critic Pipeline
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-4-synthesis-engine/" class="nav-link ">
                                        Synthesis Engine
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-5-system-integration/" class="nav-link ">
                                        System Integration
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-6-complete-implementation/" class="nav-link ">
                                        Complete Implementation
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </header>

        
        <main class="site-main">
            <div class="container">
                
<article class="content-article">
    
    <header class="article-header">
        <div class="article-meta">
            <span class="article-weight">Chapter 5</span>
            <span class="article-separator">‚Ä¢</span>
            <time class="article-date">July 29, 2025</time>
        </div>
        
        <h1 class="article-title">Chapter 5: System Integration</h1>
        
        
        <p class="article-description">Combining all CNS 2.0 components into a working system with workflow management</p>
        
        
        
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 83.35000000000001%"></div>
            </div>
            <span class="progress-text">5/6 chapters completed</span>
        </div>
    </header>

    
    <aside class="article-toc">
        <h3>Table of Contents</h3>
        <nav id="TableOfContents">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#building-the-complete-cns-20-system">Building the Complete CNS 2.0 System</a></li>
    <li><a href="#system-architecture-overview">System Architecture Overview</a></li>
  </ul>
</nav>
        </nav>
    </aside>

    
    <div class="article-content">
        <div class="guide-header">
    <a href="/" class="home-link">‚Üê Back to GTCode.com Homepage</a>
</div>
<h1 id="chapter-5-system-integration">Chapter 5: System Integration</h1>
<h2 id="building-the-complete-cns-20-system">Building the Complete CNS 2.0 System</h2>
<p>Now that we&rsquo;ve implemented the core components‚ÄîStructured Narrative Objects, the Multi-Component Critic Pipeline, and the Generative Synthesis Engine‚Äîit&rsquo;s time to integrate them into a cohesive system. This chapter focuses on the operational workflow, system dynamics, and the critical narrative ingestion pipeline.</p>
<p>The complete CNS 2.0 system operates as a continuous loop, processing new information, evaluating conflicts, and generating synthetic knowledge through dialectical reasoning.</p>
<h2 id="system-architecture-overview">System Architecture Overview</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">CNS 2.0 System Integration
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">=========================
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Complete system architecture bringing together all components
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> asyncio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Optional, Any, AsyncGenerator
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass, field
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> concurrent.futures <span style="color:#f92672">import</span> ThreadPoolExecutor
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> queue <span style="color:#f92672">import</span> PriorityQueue
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Configure system-wide logging</span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(
</span></span><span style="display:flex;"><span>    level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO,
</span></span><span style="display:flex;"><span>    format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%(asctime)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(name)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(levelname)s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%(message)s</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SystemMetrics</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Track system performance and behavior&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    total_snos: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    active_syntheses: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    successful_syntheses: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    failed_syntheses: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    average_trust_score: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>    processing_rate: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>  <span style="color:#75715e"># SNOs per hour</span>
</span></span><span style="display:flex;"><span>    uptime: timedelta <span style="color:#f92672">=</span> field(default_factory<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span>: timedelta(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_dict</span>(self) <span style="color:#f92672">-&gt;</span> Dict[str, Any]:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;total_snos&#39;</span>: self<span style="color:#f92672">.</span>total_snos,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;active_syntheses&#39;</span>: self<span style="color:#f92672">.</span>active_syntheses,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;successful_syntheses&#39;</span>: self<span style="color:#f92672">.</span>successful_syntheses,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;failed_syntheses&#39;</span>: self<span style="color:#f92672">.</span>failed_syntheses,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;average_trust_score&#39;</span>: self<span style="color:#f92672">.</span>average_trust_score,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;processing_rate&#39;</span>: self<span style="color:#f92672">.</span>processing_rate,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;uptime_hours&#39;</span>: self<span style="color:#f92672">.</span>uptime<span style="color:#f92672">.</span>total_seconds() <span style="color:#f92672">/</span> <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProcessingTask</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Represents a task in the system processing queue&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    task_id: str
</span></span><span style="display:flex;"><span>    task_type: str  <span style="color:#75715e"># &#39;ingest&#39;, &#39;synthesize&#39;, &#39;evaluate&#39;</span>
</span></span><span style="display:flex;"><span>    priority: int  <span style="color:#75715e"># Lower numbers = higher priority</span>
</span></span><span style="display:flex;"><span>    payload: Dict[str, Any]
</span></span><span style="display:flex;"><span>    created_at: datetime <span style="color:#f92672">=</span> field(default_factory<span style="color:#f92672">=</span>datetime<span style="color:#f92672">.</span>now)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__lt__</span>(self, other):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>priority <span style="color:#f92672">&lt;</span> other<span style="color:#f92672">.</span>priority
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NarrativeIngestionPipeline</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Critical component for converting unstructured sources into SNOs
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    This represents a major research challenge in argumentation mining
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, embedding_model<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>embedding_model <span style="color:#f92672">=</span> embedding_model  <span style="color:#75715e"># Pre-loaded model for efficiency</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>extraction_stats <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;documents_processed&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;snos_created&#39;</span>: <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;extraction_failures&#39;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ingest_document</span>(self, 
</span></span><span style="display:flex;"><span>                            document_text: str, 
</span></span><span style="display:flex;"><span>                            source_metadata: Dict[str, Any]) <span style="color:#f92672">-&gt;</span> Optional[StructuredNarrativeObject]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Convert unstructured document into SNO through argumentation mining
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        This is a simplified implementation - in production, this would involve:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        1. Advanced NLP for claim extraction
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        2. Sophisticated reasoning graph construction
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        3. Evidence linking and verification
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Starting document ingestion: </span><span style="color:#e6db74">{</span>source_metadata<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;title&#39;</span>, <span style="color:#e6db74">&#39;Unknown&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Step 1: Hypothesis Extraction</span>
</span></span><span style="display:flex;"><span>            central_hypothesis <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_extract_central_hypothesis(document_text)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> central_hypothesis:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#34;Failed to extract central hypothesis&#34;</span>)
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>extraction_stats[<span style="color:#e6db74">&#39;extraction_failures&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Step 2: Create SNO</span>
</span></span><span style="display:flex;"><span>            sno <span style="color:#f92672">=</span> StructuredNarrativeObject(central_hypothesis)
</span></span><span style="display:flex;"><span>            sno<span style="color:#f92672">.</span>metadata<span style="color:#f92672">.</span>update(source_metadata)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Step 3: Reasoning Graph Construction</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_construct_reasoning_graph(sno, document_text)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Step 4: Evidence Set Population</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_populate_evidence_set(sno, document_text, source_metadata)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Step 5: Compute embeddings using the pre-loaded model</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>embedding_model:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">&#34;Embedding model not loaded; cannot compute hypothesis embedding.&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>            sno<span style="color:#f92672">.</span>compute_hypothesis_embedding(self<span style="color:#f92672">.</span>embedding_model)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>extraction_stats[<span style="color:#e6db74">&#39;documents_processed&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>extraction_stats[<span style="color:#e6db74">&#39;snos_created&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Successfully created SNO: </span><span style="color:#e6db74">{</span>sno<span style="color:#f92672">.</span>sno_id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> sno
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Ingestion failed: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>extraction_stats[<span style="color:#e6db74">&#39;extraction_failures&#39;</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_extract_central_hypothesis</span>(self, document_text: str) <span style="color:#f92672">-&gt;</span> Optional[str]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Extract the main claim or hypothesis from document text&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Simplified extraction using heuristics</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># In production: use fine-tuned LLM with specific prompts</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sentences <span style="color:#f92672">=</span> document_text<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;.&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Look for sentences with hypothesis indicators</span>
</span></span><span style="display:flex;"><span>        hypothesis_indicators <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;we propose&#39;</span>, <span style="color:#e6db74">&#39;we argue&#39;</span>, <span style="color:#e6db74">&#39;we demonstrate&#39;</span>, <span style="color:#e6db74">&#39;we show&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;this paper&#39;</span>, <span style="color:#e6db74">&#39;our findings&#39;</span>, <span style="color:#e6db74">&#39;we conclude&#39;</span>, <span style="color:#e6db74">&#39;we find&#39;</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> sentence <span style="color:#f92672">in</span> sentences:
</span></span><span style="display:flex;"><span>            sentence_lower <span style="color:#f92672">=</span> sentence<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> any(indicator <span style="color:#f92672">in</span> sentence_lower <span style="color:#66d9ef">for</span> indicator <span style="color:#f92672">in</span> hypothesis_indicators):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> len(sentence<span style="color:#f92672">.</span>strip()) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">20</span>:  <span style="color:#75715e"># Reasonable length</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> sentence<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Fallback: return first substantial sentence</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> sentence <span style="color:#f92672">in</span> sentences[:<span style="color:#ae81ff">5</span>]:  <span style="color:#75715e"># Check first 5 sentences</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(sentence<span style="color:#f92672">.</span>strip()) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">30</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> sentence<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_construct_reasoning_graph</span>(self, sno: StructuredNarrativeObject, document_text: str):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Extract sub-claims and their relationships&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Simplified implementation - in production, use advanced NLP</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        sentences <span style="color:#f92672">=</span> [s<span style="color:#f92672">.</span>strip() <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> document_text<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;.&#39;</span>) <span style="color:#66d9ef">if</span> len(s<span style="color:#f92672">.</span>strip()) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">20</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add key sentences as claims</span>
</span></span><span style="display:flex;"><span>        claim_indicators <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;because&#39;</span>, <span style="color:#e6db74">&#39;therefore&#39;</span>, <span style="color:#e6db74">&#39;thus&#39;</span>, <span style="color:#e6db74">&#39;furthermore&#39;</span>, <span style="color:#e6db74">&#39;however&#39;</span>, <span style="color:#e6db74">&#39;consequently&#39;</span>]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, sentence <span style="color:#f92672">in</span> enumerate(sentences[:<span style="color:#ae81ff">10</span>]):  <span style="color:#75715e"># Limit for demo</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> any(indicator <span style="color:#f92672">in</span> sentence<span style="color:#f92672">.</span>lower() <span style="color:#66d9ef">for</span> indicator <span style="color:#f92672">in</span> claim_indicators):
</span></span><span style="display:flex;"><span>                claim_id <span style="color:#f92672">=</span> sno<span style="color:#f92672">.</span>add_claim(sentence, claim_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;supporting_claim&#34;</span>)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Simple heuristic: link to root if it contains supporting language</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> any(word <span style="color:#f92672">in</span> sentence<span style="color:#f92672">.</span>lower() <span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;because&#39;</span>, <span style="color:#e6db74">&#39;therefore&#39;</span>, <span style="color:#e6db74">&#39;thus&#39;</span>]):
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                        sno<span style="color:#f92672">.</span>add_reasoning_edge(claim_id, <span style="color:#e6db74">&#34;root&#34;</span>, RelationType<span style="color:#f92672">.</span>SUPPORTS)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ValueError</span>:
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">pass</span>  <span style="color:#75715e"># Skip if would create cycle</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_populate_evidence_set</span>(self, 
</span></span><span style="display:flex;"><span>                                   sno: StructuredNarrativeObject, 
</span></span><span style="display:flex;"><span>                                   document_text: str, 
</span></span><span style="display:flex;"><span>                                   source_metadata: Dict[str, Any]):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Link claims to evidence sources&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Extract citations and references</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Look for citation patterns</span>
</span></span><span style="display:flex;"><span>        citation_patterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;\[(\d+)\]&#39;</span>,  <span style="color:#75715e"># [1], [2], etc.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;\(([^)]+\s+\d</span><span style="color:#e6db74">{4}</span><span style="color:#e6db74">)\)&#39;</span>,  <span style="color:#75715e"># (Author 2023)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;doi:\s*([^\s]+)&#39;</span>,  <span style="color:#75715e"># DOI patterns</span>
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        evidence_items <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> pattern <span style="color:#f92672">in</span> citation_patterns:
</span></span><span style="display:flex;"><span>            matches <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>findall(pattern, document_text)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">in</span> matches:
</span></span><span style="display:flex;"><span>                evidence_item <span style="color:#f92672">=</span> EvidenceItem(
</span></span><span style="display:flex;"><span>                    content<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Citation reference: </span><span style="color:#e6db74">{</span>match<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                    source_id<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;ref_</span><span style="color:#e6db74">{</span>hash(match) <span style="color:#f92672">%</span> <span style="color:#ae81ff">10000</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                    confidence<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                evidence_items<span style="color:#f92672">.</span>append(evidence_item)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add document itself as evidence</span>
</span></span><span style="display:flex;"><span>        document_evidence <span style="color:#f92672">=</span> EvidenceItem(
</span></span><span style="display:flex;"><span>            content<span style="color:#f92672">=</span>document_text[:<span style="color:#ae81ff">500</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;...&#34;</span> <span style="color:#66d9ef">if</span> len(document_text) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">500</span> <span style="color:#66d9ef">else</span> document_text,
</span></span><span style="display:flex;"><span>            source_id<span style="color:#f92672">=</span>source_metadata<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;doc_id&#39;</span>, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;doc_</span><span style="color:#e6db74">{</span>hash(document_text) <span style="color:#f92672">%</span> <span style="color:#ae81ff">10000</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>),
</span></span><span style="display:flex;"><span>            confidence<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        evidence_items<span style="color:#f92672">.</span>append(document_evidence)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Add all evidence to SNO</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> evidence <span style="color:#f92672">in</span> evidence_items:
</span></span><span style="display:flex;"><span>            sno<span style="color:#f92672">.</span>add_evidence(evidence)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### From Paper to Code: A Research Challenge in Practice</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The paper <span style="color:#f92672">is</span> very clear <span style="color:#f92672">in</span> Section <span style="color:#ae81ff">3.1</span> that the Narrative Ingestion Pipeline <span style="color:#f92672">is</span> a significant undertaking<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">**</span>From the Paper (Section <span style="color:#ae81ff">3.1</span>):<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> A critical prerequisite <span style="color:#66d9ef">for</span> the CNS ecosystem <span style="color:#f92672">is</span> the ability to generate SNOs <span style="color:#f92672">from</span> unstructured source materials<span style="color:#f92672">...</span> This process, a form of advanced argumentation mining, <span style="color:#f92672">is</span> a major research challenge <span style="color:#f92672">in</span> itself<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The paper then outlines a proposed three<span style="color:#f92672">-</span>step pipeline:
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.</span> <span style="color:#f92672">**</span>Hypothesis Extraction:<span style="color:#f92672">**</span> Using an LLM to find the central claim<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2.</span> <span style="color:#f92672">**</span>Reasoning Graph Construction:<span style="color:#f92672">**</span> Using an LLM to identify sub<span style="color:#f92672">-</span>claims <span style="color:#f92672">and</span> their relationships<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3.</span> <span style="color:#f92672">**</span>Evidence Set Population:<span style="color:#f92672">**</span> Using pattern matching <span style="color:#f92672">and</span> semantic search to link claims to sources<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Our <span style="color:#960050;background-color:#1e0010">`</span>NarrativeIngestionPipeline<span style="color:#960050;background-color:#1e0010">`</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">is</span> a <span style="color:#f92672">*</span>pragmatic, first<span style="color:#f92672">-</span><span style="color:#66d9ef">pass</span> implementation<span style="color:#f92672">*</span> of this research roadmap<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">`</span>_extract_central_hypothesis<span style="color:#960050;background-color:#1e0010">`</span>: Instead of a full LLM, we use heuristics (looking <span style="color:#66d9ef">for</span> keywords like <span style="color:#e6db74">&#34;we propose,&#34;</span> <span style="color:#e6db74">&#34;we argue&#34;</span>) <span style="color:#66d9ef">as</span> a simplified stand<span style="color:#f92672">-</span><span style="color:#f92672">in</span> <span style="color:#66d9ef">for</span> Step <span style="color:#ae81ff">1.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">`</span>_construct_reasoning_graph<span style="color:#960050;background-color:#1e0010">`</span>: Similarly, this method uses simple keyword heuristics to find <span style="color:#f92672">and</span> link supporting claims, representing a basic version of Step <span style="color:#ae81ff">2.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">`</span>_populate_evidence_set<span style="color:#960050;background-color:#1e0010">`</span>: This method uses regular expressions (<span style="color:#960050;background-color:#1e0010">`</span>re<span style="color:#960050;background-color:#1e0010">`</span>) to find citation patterns, directly implementing the <span style="color:#e6db74">&#34;pattern matching&#34;</span> aspect of Step <span style="color:#ae81ff">3.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>This <span style="color:#f92672">is</span> a perfect example of how an engineering blueprint <span style="color:#f92672">from</span> a paper <span style="color:#f92672">is</span> translated into an initial, working prototype<span style="color:#f92672">.</span> Our implementation <span style="color:#f92672">is</span> a placeholder that demonstrates the system<span style="color:#e6db74">&#39;s structure, which can be iteratively improved with more sophisticated NLP and LLM-based models as outlined in the paper&#39;</span>s research goals<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Production Efficiency Enhancement</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">**</span>From Paper to Code: Model Management<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> Large models (embedding, NLI) should be loaded once at startup <span style="color:#f92672">and</span> reused across components rather than being loaded on<span style="color:#f92672">-</span>demand, which <span style="color:#f92672">is</span> highly inefficient<span style="color:#f92672">.</span> Our <span style="color:#960050;background-color:#1e0010">`</span>CNSWorkflowManager<span style="color:#960050;background-color:#1e0010">`</span> implements centralized model management <span style="color:#66d9ef">for</span> optimal resource usage<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CNSWorkflowManager</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Manages the complete CNS 2.0 operational workflow.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    This class acts as the central orchestrator for the system. A key design
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    principle for production efficiency is centralized model management: large ML models
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    (for embedding and NLI) are loaded once at startup and passed to the relevant
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    sub-components, avoiding costly re-loading for each task.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>sno_population: List[StructuredNarrativeObject] <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>critic_pipeline <span style="color:#f92672">=</span> CriticPipeline()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chiral_detector <span style="color:#f92672">=</span> ChiralPairDetector()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>synthesis_engine <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>  <span style="color:#75715e"># Will be implemented in next chapter</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Centralized model storage</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>embedding_model <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>nli_model <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>nli_tokenizer <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># System state</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_running <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>task_queue <span style="color:#f92672">=</span> PriorityQueue()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>metrics <span style="color:#f92672">=</span> SystemMetrics()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>start_time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>now()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Load models and initialize components</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_load_models()
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ingestion_pipeline <span style="color:#f92672">=</span> NarrativeIngestionPipeline(self<span style="color:#f92672">.</span>embedding_model)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_initialize_critics()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_load_models</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Loads all necessary ML models into memory at startup for efficient reuse&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Loading ML models into memory...&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> HAS_TRANSFORMERS:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">from</span> sentence_transformers <span style="color:#f92672">import</span> SentenceTransformer
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">import</span> transformers
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Load embedding model once for all components</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>embedding_model <span style="color:#f92672">=</span> SentenceTransformer(cns_config<span style="color:#f92672">.</span>models[<span style="color:#e6db74">&#39;embedding&#39;</span>])
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Load NLI model and tokenizer once for grounding critic</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>nli_tokenizer <span style="color:#f92672">=</span> transformers<span style="color:#f92672">.</span>AutoTokenizer<span style="color:#f92672">.</span>from_pretrained(cns_config<span style="color:#f92672">.</span>models[<span style="color:#e6db74">&#39;nli&#39;</span>])
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>nli_model <span style="color:#f92672">=</span> transformers<span style="color:#f92672">.</span>AutoModelForSequenceClassification<span style="color:#f92672">.</span>from_pretrained(cns_config<span style="color:#f92672">.</span>models[<span style="color:#e6db74">&#39;nli&#39;</span>])
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;All models loaded successfully.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#34;Transformers library not available - using fallback implementations&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_initialize_critics</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Set up the critic pipeline with pre-loaded models for efficiency&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Initialize critics with parameters from cns_config and pre-loaded models</span>
</span></span><span style="display:flex;"><span>        grounding_critic <span style="color:#f92672">=</span> GroundingCritic(
</span></span><span style="display:flex;"><span>            weight<span style="color:#f92672">=</span>cns_config<span style="color:#f92672">.</span>critic_weights[<span style="color:#e6db74">&#39;grounding&#39;</span>],
</span></span><span style="display:flex;"><span>            nli_model<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>nli_model,
</span></span><span style="display:flex;"><span>            nli_tokenizer<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>nli_tokenizer
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        logic_critic <span style="color:#f92672">=</span> LogicCritic(
</span></span><span style="display:flex;"><span>            weight<span style="color:#f92672">=</span>cns_config<span style="color:#f92672">.</span>critic_weights[<span style="color:#e6db74">&#39;logic&#39;</span>]
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        novelty_critic <span style="color:#f92672">=</span> NoveltyParsimonyCritic(
</span></span><span style="display:flex;"><span>            weight<span style="color:#f92672">=</span>cns_config<span style="color:#f92672">.</span>critic_weights[<span style="color:#e6db74">&#39;novelty&#39;</span>],
</span></span><span style="display:flex;"><span>            alpha<span style="color:#f92672">=</span>cns_config<span style="color:#f92672">.</span>novelty_alpha,
</span></span><span style="display:flex;"><span>            beta<span style="color:#f92672">=</span>cns_config<span style="color:#f92672">.</span>novelty_beta
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>critic_pipeline<span style="color:#f92672">.</span>add_critic(grounding_critic)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>critic_pipeline<span style="color:#f92672">.</span>add_critic(logic_critic)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>critic_pipeline<span style="color:#f92672">.</span>add_critic(novelty_critic)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Research-grade critic pipeline initialized with pre-loaded models for maximum efficiency&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start_system</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Start the CNS 2.0 system operational loop&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_running <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>start_time <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>now()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;CNS 2.0 System starting...&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Start concurrent processing tasks</span>
</span></span><span style="display:flex;"><span>        tasks <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>            asyncio<span style="color:#f92672">.</span>create_task(self<span style="color:#f92672">.</span>_process_task_queue()),
</span></span><span style="display:flex;"><span>            asyncio<span style="color:#f92672">.</span>create_task(self<span style="color:#f92672">.</span>_synthesis_loop()),
</span></span><span style="display:flex;"><span>            asyncio<span style="color:#f92672">.</span>create_task(self<span style="color:#f92672">.</span>_metrics_update_loop())
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>gather(<span style="color:#f92672">*</span>tasks)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyboardInterrupt</span>:
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Shutdown requested&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>shutdown_system()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_process_task_queue</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Process incoming tasks from the priority queue&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>is_running:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>task_queue<span style="color:#f92672">.</span>empty():
</span></span><span style="display:flex;"><span>                    task <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>task_queue<span style="color:#f92672">.</span>get_nowait()
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_execute_task(task)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># Prevent busy waiting</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Task processing error: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_execute_task</span>(self, task: ProcessingTask):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Execute a specific task based on its type&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> task<span style="color:#f92672">.</span>task_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;ingest&#39;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_handle_ingestion_task(task)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> task<span style="color:#f92672">.</span>task_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;evaluate&#39;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_handle_evaluation_task(task)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> task<span style="color:#f92672">.</span>task_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;synthesize&#39;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_handle_synthesis_task(task)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Unknown task type: </span><span style="color:#e6db74">{</span>task<span style="color:#f92672">.</span>task_type<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Task execution failed: </span><span style="color:#e6db74">{</span>task<span style="color:#f92672">.</span>task_id<span style="color:#e6db74">}</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_ingestion_task</span>(self, task: ProcessingTask):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Handle document ingestion tasks&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        document_text <span style="color:#f92672">=</span> task<span style="color:#f92672">.</span>payload<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;document_text&#39;</span>)
</span></span><span style="display:flex;"><span>        source_metadata <span style="color:#f92672">=</span> task<span style="color:#f92672">.</span>payload<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;source_metadata&#39;</span>, {})
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> document_text:
</span></span><span style="display:flex;"><span>            sno <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>ingestion_pipeline<span style="color:#f92672">.</span>ingest_document(document_text, source_metadata)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> sno:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Evaluate the new SNO with population context</span>
</span></span><span style="display:flex;"><span>                context <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;sno_population&#39;</span>: self<span style="color:#f92672">.</span>sno_population}
</span></span><span style="display:flex;"><span>                evaluation_result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>critic_pipeline<span style="color:#f92672">.</span>evaluate_sno(sno, context)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Add to population if it meets quality threshold</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> sno<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">and</span> sno<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.3</span>:
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>sno_population<span style="color:#f92672">.</span>append(sno)
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>total_snos <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Added SNO to population: </span><span style="color:#e6db74">{</span>sno<span style="color:#f92672">.</span>sno_id<span style="color:#e6db74">}</span><span style="color:#e6db74"> (trust: </span><span style="color:#e6db74">{</span>sno<span style="color:#f92672">.</span>trust_score<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;SNO rejected due to low trust score: </span><span style="color:#e6db74">{</span>sno<span style="color:#f92672">.</span>trust_score<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_evaluation_task</span>(self, task: ProcessingTask):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Handle SNO re-evaluation tasks&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        sno_id <span style="color:#f92672">=</span> task<span style="color:#f92672">.</span>payload<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;sno_id&#39;</span>)
</span></span><span style="display:flex;"><span>        sno <span style="color:#f92672">=</span> next((s <span style="color:#66d9ef">for</span> s <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>sno_population <span style="color:#66d9ef">if</span> s<span style="color:#f92672">.</span>sno_id <span style="color:#f92672">==</span> sno_id), <span style="color:#66d9ef">None</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> sno:
</span></span><span style="display:flex;"><span>            context <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;sno_population&#39;</span>: self<span style="color:#f92672">.</span>sno_population}
</span></span><span style="display:flex;"><span>            evaluation_result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>critic_pipeline<span style="color:#f92672">.</span>evaluate_sno(sno, context)
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Re-evaluated SNO </span><span style="color:#e6db74">{</span>sno_id<span style="color:#e6db74">}</span><span style="color:#e6db74">: trust=</span><span style="color:#e6db74">{</span>sno<span style="color:#f92672">.</span>trust_score<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_handle_synthesis_task</span>(self, task: ProcessingTask):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Handle synthesis generation tasks by calling the synthesis engine.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        chiral_pair <span style="color:#f92672">=</span> task<span style="color:#f92672">.</span>payload<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;chiral_pair&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> chiral_pair <span style="color:#f92672">or</span> <span style="color:#f92672">not</span> self<span style="color:#f92672">.</span>synthesis_engine:
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Synthesis task </span><span style="color:#e6db74">{</span>task<span style="color:#f92672">.</span>task_id<span style="color:#e6db74">}</span><span style="color:#e6db74"> failed: missing pair or engine.&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>active_syntheses <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        synthesis_result <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>synthesis_engine<span style="color:#f92672">.</span>synthesize_chiral_pair(chiral_pair)
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>active_syntheses <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> synthesis_result<span style="color:#f92672">.</span>success:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>successful_syntheses <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            new_sno <span style="color:#f92672">=</span> synthesis_result<span style="color:#f92672">.</span>synthesized_sno
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Add the new, successful SNO to the population</span>
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>sno_population<span style="color:#f92672">.</span>append(new_sno)
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>total_snos <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;New synthesized SNO </span><span style="color:#e6db74">{</span>new_sno<span style="color:#f92672">.</span>sno_id<span style="color:#e6db74">}</span><span style="color:#e6db74"> added to population.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>failed_syntheses <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Synthesis failed for task </span><span style="color:#e6db74">{</span>task<span style="color:#f92672">.</span>task_id<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>synthesis_result<span style="color:#f92672">.</span>explanation<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_synthesis_loop</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Continuously look for synthesis opportunities&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>is_running:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> len(self<span style="color:#f92672">.</span>sno_population) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#75715e"># Find chiral pairs</span>
</span></span><span style="display:flex;"><span>                    chiral_pairs <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>chiral_detector<span style="color:#f92672">.</span>find_chiral_pairs(self<span style="color:#f92672">.</span>sno_population, max_pairs<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> chiral_pairs:
</span></span><span style="display:flex;"><span>                        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Found </span><span style="color:#e6db74">{</span>len(chiral_pairs)<span style="color:#e6db74">}</span><span style="color:#e6db74"> chiral pairs for potential synthesis&#34;</span>)
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">for</span> pair <span style="color:#f92672">in</span> chiral_pairs:
</span></span><span style="display:flex;"><span>                            <span style="color:#75715e"># Queue synthesis task</span>
</span></span><span style="display:flex;"><span>                            synthesis_task <span style="color:#f92672">=</span> ProcessingTask(
</span></span><span style="display:flex;"><span>                                task_id<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;synthesis_</span><span style="color:#e6db74">{</span>pair<span style="color:#f92672">.</span>sno_a<span style="color:#f92672">.</span>sno_id[:<span style="color:#ae81ff">8</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">_</span><span style="color:#e6db74">{</span>pair<span style="color:#f92672">.</span>sno_b<span style="color:#f92672">.</span>sno_id[:<span style="color:#ae81ff">8</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                                task_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;synthesize&#34;</span>,
</span></span><span style="display:flex;"><span>                                priority<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,  <span style="color:#75715e"># High priority</span>
</span></span><span style="display:flex;"><span>                                payload<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;chiral_pair&#39;</span>: pair}
</span></span><span style="display:flex;"><span>                            )
</span></span><span style="display:flex;"><span>                            self<span style="color:#f92672">.</span>task_queue<span style="color:#f92672">.</span>put(synthesis_task)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)  <span style="color:#75715e"># Check for synthesis opportunities every 30 seconds</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Synthesis loop error: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_metrics_update_loop</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Periodically update system metrics&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> self<span style="color:#f92672">.</span>is_running:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Update metrics</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>uptime <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>now() <span style="color:#f92672">-</span> self<span style="color:#f92672">.</span>start_time
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>sno_population:
</span></span><span style="display:flex;"><span>                    trust_scores <span style="color:#f92672">=</span> [sno<span style="color:#f92672">.</span>trust_score <span style="color:#66d9ef">for</span> sno <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>sno_population <span style="color:#66d9ef">if</span> sno<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span>                    self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>average_trust_score <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(trust_scores) <span style="color:#66d9ef">if</span> trust_scores <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Calculate processing rate</span>
</span></span><span style="display:flex;"><span>                hours <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>uptime<span style="color:#f92672">.</span>total_seconds() <span style="color:#f92672">/</span> <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>                self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>processing_rate <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>total_snos <span style="color:#f92672">/</span> hours <span style="color:#66d9ef">if</span> hours <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># Log metrics every 5 minutes</span>
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;System metrics: </span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>to_dict(), indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">300</span>)  <span style="color:#75715e"># Update every 5 minutes</span>
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>                logger<span style="color:#f92672">.</span>error(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Metrics update error: </span><span style="color:#e6db74">{</span>str(e)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">shutdown_system</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Gracefully shutdown the CNS 2.0 system&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>is_running <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;CNS 2.0 System shutting down...&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Save system state</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>_save_system_state()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;System shutdown complete&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_save_system_state</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Save current system state for persistence&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        state <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;sno_count&#39;</span>: len(self<span style="color:#f92672">.</span>sno_population),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;metrics&#39;</span>: self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>to_dict(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;ingestion_stats&#39;</span>: self<span style="color:#f92672">.</span>ingestion_pipeline<span style="color:#f92672">.</span>extraction_stats,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;critic_stats&#39;</span>: {ct<span style="color:#f92672">.</span>value: c<span style="color:#f92672">.</span>get_statistics() <span style="color:#66d9ef">for</span> ct, c <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>critic_pipeline<span style="color:#f92672">.</span>critics<span style="color:#f92672">.</span>items()}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># In production, save to persistent storage</span>
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;System state: </span><span style="color:#e6db74">{</span>json<span style="color:#f92672">.</span>dumps(state, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">submit_document</span>(self, document_text: str, source_metadata: Dict[str, Any] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Submit a document for processing&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> source_metadata <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            source_metadata <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        task <span style="color:#f92672">=</span> ProcessingTask(
</span></span><span style="display:flex;"><span>            task_id<span style="color:#f92672">=</span><span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;ingest_</span><span style="color:#e6db74">{</span>datetime<span style="color:#f92672">.</span>now()<span style="color:#f92672">.</span>timestamp()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>            task_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ingest&#34;</span>,
</span></span><span style="display:flex;"><span>            priority<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>            payload<span style="color:#f92672">=</span>{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;document_text&#39;</span>: document_text,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;source_metadata&#39;</span>: source_metadata
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>task_queue<span style="color:#f92672">.</span>put(task)
</span></span><span style="display:flex;"><span>        logger<span style="color:#f92672">.</span>info(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Document submitted for ingestion: </span><span style="color:#e6db74">{</span>task<span style="color:#f92672">.</span>task_id<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_system_status</span>(self) <span style="color:#f92672">-&gt;</span> Dict[str, Any]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Get current system status&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;is_running&#39;</span>: self<span style="color:#f92672">.</span>is_running,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;population_size&#39;</span>: len(self<span style="color:#f92672">.</span>sno_population),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;queue_size&#39;</span>: self<span style="color:#f92672">.</span>task_queue<span style="color:#f92672">.</span>qsize(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;metrics&#39;</span>: self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>to_dict(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;uptime&#39;</span>: str(self<span style="color:#f92672">.</span>metrics<span style="color:#f92672">.</span>uptime)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Example usage and testing</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">demo_system_integration</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Demonstrate the integrated CNS 2.0 system&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Initialize system</span>
</span></span><span style="display:flex;"><span>    workflow_manager <span style="color:#f92672">=</span> CNSWorkflowManager()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Submit sample documents</span>
</span></span><span style="display:flex;"><span>    sample_documents <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;text&#39;</span>: <span style="color:#e6db74">&#34;We propose that machine learning algorithms can effectively identify patterns in complex datasets. Our experiments demonstrate significant improvements in accuracy when using ensemble methods. The evidence strongly supports the hypothesis that combining multiple models leads to better performance.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;metadata&#39;</span>: {<span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;ML Ensemble Study&#39;</span>, <span style="color:#e6db74">&#39;author&#39;</span>: <span style="color:#e6db74">&#39;Research Team A&#39;</span>}
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;text&#39;</span>: <span style="color:#e6db74">&#34;We argue that simple models often outperform complex ensembles in real-world scenarios. Our analysis shows that overly complex models tend to overfit and perform poorly on new data. The results contradict claims about ensemble superiority.&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;metadata&#39;</span>: {<span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;Simplicity in ML&#39;</span>, <span style="color:#e6db74">&#39;author&#39;</span>: <span style="color:#e6db74">&#39;Research Team B&#39;</span>}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> doc <span style="color:#f92672">in</span> sample_documents:
</span></span><span style="display:flex;"><span>        workflow_manager<span style="color:#f92672">.</span>submit_document(doc[<span style="color:#e6db74">&#39;text&#39;</span>], doc[<span style="color:#e6db74">&#39;metadata&#39;</span>])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Sample documents submitted to CNS 2.0 system&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;System would process these through the complete pipeline:&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;1. Narrative ingestion and SNO creation&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;2. Multi-component critic evaluation&#34;</span>) 
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;3. Chiral pair detection&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;4. Synthesis generation (Chapter 6)&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> workflow_manager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Run the demo</span>
</span></span><span style="display:flex;"><span>    asyncio<span style="color:#f92672">.</span>run(demo_system_integration())
</span></span></code></pre></div>
    </div>

    
    <nav class="article-nav">
        <div class="nav-previous">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-6-complete-implementation/" class="nav-link prev-link">
                    <i data-feather="arrow-right"></i>
                    <div class="nav-text">
                        <span class="nav-label">Next</span>
                        <span class="nav-title">Chapter 6: Complete Implementation</span>
                    </div>
                </a>
            
        </div>
        
        <div class="nav-next">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-4-synthesis-engine/" class="nav-link next-link">
                    <div class="nav-text">
                        <span class="nav-label">Previous</span>
                        <span class="nav-title">Chapter 4: Generative Synthesis Engine</span>
                    </div>
                    <i data-feather="arrow-left"></i>
                </a>
            
        </div>
    </nav>

    
    <aside class="chapter-summary">
        <h3>Chapter Summary</h3>
        <div class="summary-content">
            
                <p>Integrating all components into a cohesive, operational system.</p>
                <ul>
                    <li>System architecture and workflow</li>
                    <li>Narrative ingestion pipeline</li>
                    <li>Concurrent processing and monitoring</li>
                </ul>
            
        </div>
    </aside>
</article>

            </div>
        </main>

        
        <footer class="site-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-text">
                        <p>&copy; 2025 <a href="https://GTCode.com/" class="footer-link">GTCode.com</a>. Educational content for CNS 2.0 implementation.</p>
                        <p>Based on <a target="_blank" 
                               rel="noopener noreferrer" href="/papers/ResearchProposal-ChiralNarrativeSynthesis_20250617.pdf" class="footer-link">CNS 2.0: A Practical Blueprint for Chiral Narrative Synthesis</a> research paper.</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    
    <script src="/js/navigation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
    
    <script>
        
        if (window.feather) feather.replace();
    </script>
</body>
</html>
