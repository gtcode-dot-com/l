<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chapter 2: SNO Foundations | Building CNS 2.0: A Developer&#39;s Guide</title>
    <meta name="description" content="Building Structured Narrative Objects - the core data structure of CNS 2.0">
    <meta name="author" content="CNS Development Team">
    
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">
    
    
    <link rel="stylesheet" href="/css/style.css?v=1753847223">
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    




    
    
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
    <div class="site-wrapper">
        
        <header class="site-header">
            <div class="container">
                <nav class="main-nav">
                    <div class="nav-brand">
                        <a href="/guides/building-cns-2.0-developers-guide/" class="brand-link">
                            <span class="brand-icon">üß†</span>
                            <span class="brand-text">Building CNS 2.0: A Developer&#39;s Guide</span>
                        </a>
                    </div>
                    
                    <div class="nav-menu">
                        <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
                            <i data-feather="menu"></i>
                        </button>
                        
                        <ul class="nav-list">
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-1-introduction/" class="nav-link ">
                                        Introduction
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-2-sno-foundations/" class="nav-link ">
                                        SNO Foundations
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-3-critic-pipeline/" class="nav-link ">
                                        Critic Pipeline
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-4-synthesis-engine/" class="nav-link ">
                                        Synthesis Engine
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-5-system-integration/" class="nav-link ">
                                        System Integration
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-6-complete-implementation/" class="nav-link ">
                                        Complete Implementation
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-7-dspy-integration/" class="nav-link ">
                                        DSPy Integration
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </header>

        
        <main class="site-main">
            <div class="container">
                
<article class="content-article">
    
    <header class="article-header">
        <div class="article-meta">
            <span class="article-weight">Chapter 2</span>
            <span class="article-separator">‚Ä¢</span>
            <time class="article-date">July 29, 2025</time>
        </div>
        
        <h1 class="article-title">Chapter 2: SNO Foundations</h1>
        
        
        <p class="article-description">Building Structured Narrative Objects - the core data structure of CNS 2.0</p>
        
        
        
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 33.34%"></div>
            </div>
            <span class="progress-text">2/6 chapters completed</span>
        </div>
    </header>

    
    <aside class="article-toc">
        <h3>Table of Contents</h3>
        <nav id="TableOfContents">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#understanding-structured-narrative-objects">Understanding Structured Narrative Objects</a>
      <ul>
        <li><a href="#from-paper-to-code-the-mathematical-foundation">From Paper to Code: The Mathematical Foundation</a></li>
      </ul>
    </li>
    <li><a href="#core-sno-implementation">Core SNO Implementation</a></li>
  </ul>
</nav>
        </nav>
    </aside>

    
    <div class="article-content">
        <div class="guide-header">
    <a href="/" class="home-link">‚Üê Back to GTCode.com Homepage</a>
</div>
<h1 id="chapter-2-sno-foundations">Chapter 2: SNO Foundations</h1>
<h2 id="understanding-structured-narrative-objects">Understanding Structured Narrative Objects</h2>
<p>Structured Narrative Objects (SNOs) are the heart of CNS 2.0. Unlike simple vector representations that lose critical structural information, SNOs preserve the full richness of argumentative structure while maintaining computational tractability.</p>
<p>An SNO is formally defined as a 4-tuple: <strong>ùíÆ = (H, G, ‚Ñ∞, T)</strong> where:</p>
<ul>
<li><strong>H</strong>: Hypothesis Embedding (dense vector)</li>
<li><strong>G</strong>: Reasoning Graph (directed acyclic graph)</li>
<li><strong>‚Ñ∞</strong>: Evidence Set (grounding data sources)</li>
<li><strong>T</strong>: Trust Score (derived confidence measure)</li>
</ul>
<h3 id="from-paper-to-code-the-mathematical-foundation">From Paper to Code: The Mathematical Foundation</h3>
<p>First, let&rsquo;s look at the formal definition from the paper. Section 2.1 defines a Structured Narrative Object as a mathematical construct.</p>
<blockquote>
<p><strong>Definition 2.1 (Structured Narrative Object)</strong>
An SNO is a 4-tuple $\mathcal{S} = (H, G, \mathcal{E}, T)$ where:</p>
<ul>
<li><strong>Hypothesis Embedding</strong> $H \in \mathbb{R}^d$: A $d$-dimensional dense vector encoding the narrative&rsquo;s central claim, enabling geometric similarity computations while preserving semantic content</li>
<li><strong>Reasoning Graph</strong> $G = (V, E_G)$: A directed acyclic graph with vertices $V$ representing sub-claims and edges $E_G \subseteq V \times V \times \mathcal{R}$ encoding typed logical relationships (e.g., &ldquo;supports,&rdquo; &ldquo;contradicts,&rdquo; &ldquo;implies&rdquo;) from the relation set $\mathcal{R}$</li>
<li><strong>Evidence Set</strong> $\mathcal{E} = \{e_1, e_2, \ldots, e_n\}$: Pointers to grounding data sources, including document identifiers, data hashes, or persistent identifiers (DOIs), establishing verifiable connections to primary sources</li>
<li><strong>Trust Score</strong> $T \in [0, 1]$: A derived confidence measure computed by the critic pipeline, not an intrinsic property of the narrative</li>
</ul></blockquote>
<p><strong>From Paper to Code:</strong></p>
<p>Our <code>StructuredNarrativeObject</code> Python class is the direct, practical implementation of this mathematical 4-tuple. Let&rsquo;s map the theory to our code:</p>
<ul>
<li><strong><code>H</code> (Hypothesis Embedding):</strong> This corresponds to the <code>self.hypothesis_embedding</code> attribute in our class. It&rsquo;s an optional <code>np.ndarray</code> that will hold the dense vector representation of the SNO&rsquo;s central claim, calculated by the <code>compute_hypothesis_embedding</code> method.</li>
<li><strong><code>G</code> (Reasoning Graph):</strong> This is implemented as <code>self.reasoning_graph</code>, a <code>networkx.DiGraph</code> object. The vertices <code>V</code> are the nodes added via <code>add_claim</code>, and the edges <code>E_G</code> are the relationships added with <code>add_reasoning_edge</code>. The paper&rsquo;s requirement that it be a <em>directed acyclic graph</em> is enforced by our check for cycles within the <code>add_reasoning_edge</code> method.</li>
<li><strong><code>‚Ñ∞</code> (Evidence Set):</strong> This is our <code>self.evidence_set</code>, a Python <code>set</code> containing <code>EvidenceItem</code> objects. This perfectly matches the definition of a collection of pointers to grounding data.</li>
<li><strong><code>T</code> (Trust Score):</strong> This is the <code>self.trust_score</code> attribute. As the paper states, it is &ldquo;not an intrinsic property&rdquo; but is &ldquo;derived,&rdquo; which is why it&rsquo;s initialized as <code>None</code> and will be populated later by our <code>CriticPipeline</code>.</li>
</ul>
<p>Understanding this mapping is key. We&rsquo;re not just creating a data class; we&rsquo;re instantiating a formal mathematical object described in the paper.</p>
<h4 id="a-note-on-embeddings">A Note on Embeddings</h4>
<p>For the mathematical primitives like the Chirality Score and Novelty Score to work as intended, we need a semantically meaningful vector space. Simple fallbacks like hash-based vectors produce random outputs that destroy any geometric meaning, rendering the core CNS 2.0 mechanics useless. Therefore, our implementation treats a real embedding model as a mandatory component.</p>
<h2 id="core-sno-implementation">Core SNO Implementation</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Structured Narrative Objects (SNO) Implementation
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">===============================================
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">The foundational data structure for CNS 2.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> networkx <span style="color:#66d9ef">as</span> nx
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Tuple, Set, Optional, Any
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass, field
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> uuid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ReasoningEdge</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Represents a typed logical relationship in the reasoning graph&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    source: str
</span></span><span style="display:flex;"><span>    target: str
</span></span><span style="display:flex;"><span>    relation_type: RelationType
</span></span><span style="display:flex;"><span>    strength: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>  <span style="color:#75715e"># Relationship strength [0,1]</span>
</span></span><span style="display:flex;"><span>    metadata: Dict[str, Any] <span style="color:#f92672">=</span> field(default_factory<span style="color:#f92672">=</span>dict)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClaimNode</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Represents a claim or sub-claim in the reasoning graph&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    claim_id: str
</span></span><span style="display:flex;"><span>    content: str
</span></span><span style="display:flex;"><span>    claim_type: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;assertion&#34;</span>  <span style="color:#75715e"># assertion, premise, conclusion, etc.</span>
</span></span><span style="display:flex;"><span>    embedding: Optional[np<span style="color:#f92672">.</span>ndarray] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    metadata: Dict[str, Any] <span style="color:#f92672">=</span> field(default_factory<span style="color:#f92672">=</span>dict)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">StructuredNarrativeObject</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Complete implementation of a Structured Narrative Object (SNO)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    This class encapsulates all four components of an SNO:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - Hypothesis Embedding (H)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - Reasoning Graph (G) 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - Evidence Set (E)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - Trust Score (T)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, 
</span></span><span style="display:flex;"><span>                 central_hypothesis: str,
</span></span><span style="display:flex;"><span>                 sno_id: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Initialize a new SNO with a central hypothesis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            central_hypothesis: The main claim or hypothesis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            sno_id: Unique identifier (auto-generated if None)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>sno_id <span style="color:#f92672">=</span> sno_id <span style="color:#f92672">or</span> str(uuid<span style="color:#f92672">.</span>uuid4())
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>central_hypothesis <span style="color:#f92672">=</span> central_hypothesis
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>created_at <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>now()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># H: Hypothesis Embedding - will be computed later</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>hypothesis_embedding: Optional[np<span style="color:#f92672">.</span>ndarray] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># G: Reasoning Graph - NetworkX directed graph</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>reasoning_graph <span style="color:#f92672">=</span> nx<span style="color:#f92672">.</span>DiGraph()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># E: Evidence Set - collection of evidence items</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>evidence_set: Set[EvidenceItem] <span style="color:#f92672">=</span> set()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># T: Trust Score - computed by critic pipeline</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>trust_score: Optional[float] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Additional metadata</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>metadata: Dict[str, Any] <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Initialize with central hypothesis as root node</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_add_root_claim()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_add_root_claim</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Add the central hypothesis as the root node of the reasoning graph&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        root_node <span style="color:#f92672">=</span> ClaimNode(
</span></span><span style="display:flex;"><span>            claim_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;root&#34;</span>,
</span></span><span style="display:flex;"><span>            content<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>central_hypothesis,
</span></span><span style="display:flex;"><span>            claim_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;central_hypothesis&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>add_node(<span style="color:#e6db74">&#34;root&#34;</span>, claim<span style="color:#f92672">=</span>root_node)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_claim</span>(self, 
</span></span><span style="display:flex;"><span>                  claim_content: str, 
</span></span><span style="display:flex;"><span>                  claim_id: Optional[str] <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>,
</span></span><span style="display:flex;"><span>                  claim_type: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;assertion&#34;</span>) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Add a new claim to the reasoning graph
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            claim_content: Text content of the claim
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            claim_id: Unique identifier (auto-generated if None)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            claim_type: Type of claim (assertion, premise, conclusion, etc.)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            The claim_id of the added claim
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> claim_id <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            claim_id <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;claim_</span><span style="color:#e6db74">{</span>len(self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>nodes)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        claim_node <span style="color:#f92672">=</span> ClaimNode(
</span></span><span style="display:flex;"><span>            claim_id<span style="color:#f92672">=</span>claim_id,
</span></span><span style="display:flex;"><span>            content<span style="color:#f92672">=</span>claim_content,
</span></span><span style="display:flex;"><span>            claim_type<span style="color:#f92672">=</span>claim_type
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>add_node(claim_id, claim<span style="color:#f92672">=</span>claim_node)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> claim_id
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_reasoning_edge</span>(self,
</span></span><span style="display:flex;"><span>                          source_claim_id: str,
</span></span><span style="display:flex;"><span>                          target_claim_id: str,
</span></span><span style="display:flex;"><span>                          relation_type: RelationType,
</span></span><span style="display:flex;"><span>                          strength: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span>) <span style="color:#f92672">-&gt;</span> bool:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Add a reasoning relationship between two claims
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            source_claim_id: ID of the source claim
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            target_claim_id: ID of the target claim
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            relation_type: Type of logical relationship
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            strength: Strength of the relationship [0,1]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Returns:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            True if edge was added successfully
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (source_claim_id <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>nodes <span style="color:#f92672">or</span> 
</span></span><span style="display:flex;"><span>            target_claim_id <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>nodes):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check for cycles (reasoning graph must be acyclic)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> nx<span style="color:#f92672">.</span>has_path(self<span style="color:#f92672">.</span>reasoning_graph, target_claim_id, source_claim_id):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;Adding this edge would create a cycle&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        edge <span style="color:#f92672">=</span> ReasoningEdge(
</span></span><span style="display:flex;"><span>            source<span style="color:#f92672">=</span>source_claim_id,
</span></span><span style="display:flex;"><span>            target<span style="color:#f92672">=</span>target_claim_id,
</span></span><span style="display:flex;"><span>            relation_type<span style="color:#f92672">=</span>relation_type,
</span></span><span style="display:flex;"><span>            strength<span style="color:#f92672">=</span>strength
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>add_edge(
</span></span><span style="display:flex;"><span>            source_claim_id, 
</span></span><span style="display:flex;"><span>            target_claim_id, 
</span></span><span style="display:flex;"><span>            reasoning_edge<span style="color:#f92672">=</span>edge
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_evidence</span>(self, evidence_item: EvidenceItem):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Add evidence to support claims in this SNO&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>evidence_set<span style="color:#f92672">.</span>add(evidence_item)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">compute_hypothesis_embedding</span>(self, embedding_model):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Compute the hypothesis embedding using a sentence transformer model.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        This is a critical step for all geometric operations in CNS 2.0.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Args:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            embedding_model: A loaded sentence-transformer model instance.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># A real embedding is non-negotiable for research-grade implementation.</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">=</span> embedding_model<span style="color:#f92672">.</span>encode(self<span style="color:#f92672">.</span>central_hypothesis)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_graph_statistics</span>(self) <span style="color:#f92672">-&gt;</span> Dict[str, Any]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Compute statistics about the reasoning graph&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        stats <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;num_nodes&#39;</span>: self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>number_of_nodes(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;num_edges&#39;</span>: self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>number_of_edges(),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;is_acyclic&#39;</span>: nx<span style="color:#f92672">.</span>is_directed_acyclic_graph(self<span style="color:#f92672">.</span>reasoning_graph),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;density&#39;</span>: nx<span style="color:#f92672">.</span>density(self<span style="color:#f92672">.</span>reasoning_graph),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;relation_type_counts&#39;</span>: {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Count relation types</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> _, _, edge_data <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>edges(data<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;reasoning_edge&#39;</span> <span style="color:#f92672">in</span> edge_data:
</span></span><span style="display:flex;"><span>                rel_type <span style="color:#f92672">=</span> edge_data[<span style="color:#e6db74">&#39;reasoning_edge&#39;</span>]<span style="color:#f92672">.</span>relation_type<span style="color:#f92672">.</span>value
</span></span><span style="display:flex;"><span>                stats[<span style="color:#e6db74">&#39;relation_type_counts&#39;</span>][rel_type] <span style="color:#f92672">=</span> stats[<span style="color:#e6db74">&#39;relation_type_counts&#39;</span>]<span style="color:#f92672">.</span>get(rel_type, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> stats
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__repr__</span>(self) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;SNO(id=</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>sno_id[:<span style="color:#ae81ff">8</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">, hypothesis=&#39;</span><span style="color:#e6db74">{</span>self<span style="color:#f92672">.</span>central_hypothesis[:<span style="color:#ae81ff">50</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">...&#39;)&#34;</span>
</span></span></code></pre></div>
    </div>

    
    <nav class="article-nav">
        <div class="nav-previous">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-3-critic-pipeline/" class="nav-link prev-link">
                    <i data-feather="arrow-right"></i>
                    <div class="nav-text">
                        <span class="nav-label">Next</span>
                        <span class="nav-title">Chapter 3: Multi-Component Critic Pipeline</span>
                    </div>
                </a>
            
        </div>
        
        <div class="nav-next">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-1-introduction/" class="nav-link next-link">
                    <div class="nav-text">
                        <span class="nav-label">Previous</span>
                        <span class="nav-title">Chapter 1: Introduction to CNS 2.0</span>
                    </div>
                    <i data-feather="arrow-left"></i>
                </a>
            
        </div>
    </nav>

    
    <aside class="chapter-summary">
        <h3>Chapter Summary</h3>
        <div class="summary-content">
            
                <p>Building Structured Narrative Objects - the foundational data structure of CNS 2.0.</p>
                <ul>
                    <li>SNO 4-tuple structure implementation</li>
                    <li>Reasoning graph construction</li>
                    <li>Evidence set management</li>
                </ul>
            
        </div>
    </aside>
</article>

            </div>
        </main>

        
        <footer class="site-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-text">
                        <p>&copy; 2025 <a href="https://GTCode.com/" class="footer-link">GTCode.com</a>. Educational content for CNS 2.0 implementation.</p>
                        <p>Based on <a target="_blank" 
                               rel="noopener noreferrer" href="/papers/ResearchProposal-ChiralNarrativeSynthesis_20250617_3.pdf" class="footer-link">CNS 2.0: A Practical Blueprint for Chiral Narrative Synthesis</a> research paper. (20250617 Version 3)</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    
    <script src="/js/navigation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
    
    <script>
        
        if (window.feather) feather.replace();
    </script>
</body>
</html>
