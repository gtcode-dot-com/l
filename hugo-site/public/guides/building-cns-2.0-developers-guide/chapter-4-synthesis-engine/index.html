<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chapter 4: Generative Synthesis Engine | Building CNS 2.0: A Developer&#39;s Guide</title>
    <meta name="description" content="Implementing LLM-powered dialectical reasoning for knowledge synthesis">
    <meta name="author" content="CNS Development Team">
    
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß†</text></svg>">
    
    
    <link rel="stylesheet" href="/css/style.css?v=1753859163">
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    




    
    
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
    <div class="site-wrapper">
        
        <header class="site-header">
            <div class="container">
                <nav class="main-nav">
                    <div class="nav-brand">
                        <a href="/guides/building-cns-2.0-developers-guide/" class="brand-link">
                            <span class="brand-icon">üß†</span>
                            <span class="brand-text">Building CNS 2.0: A Developer&#39;s Guide</span>
                        </a>
                    </div>
                    
                    <div class="nav-menu">
                        <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
                            <i data-feather="menu"></i>
                        </button>
                        
                        <ul class="nav-list">
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-1-introduction/" class="nav-link ">
                                        Introduction
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-2-sno-foundations/" class="nav-link ">
                                        SNO Foundations
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-3-critic-pipeline/" class="nav-link ">
                                        Critic Pipeline
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-4-synthesis-engine/" class="nav-link ">
                                        Synthesis Engine
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-5-system-integration/" class="nav-link ">
                                        System Integration
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-6-complete-implementation/" class="nav-link ">
                                        Complete Implementation
                                    </a>
                                </li>
                            
                                <li class="nav-item">
                                    <a href="/guides/building-cns-2.0-developers-guide/chapter-7-dspy-integration/" class="nav-link ">
                                        DSPy Integration
                                    </a>
                                </li>
                            
                        </ul>
                    </div>
                </nav>
            </div>
        </header>

        
        <main class="site-main">
            <div class="container">
                
<article class="content-article">
    
    <header class="article-header">
        <div class="article-meta">
            <span class="article-weight">Chapter 4 of 7</span>
            <span class="article-separator">‚Ä¢</span>
            <time class="article-date">July 29, 2025</time>
        </div>
        
        <h1 class="article-title">Chapter 4: Generative Synthesis Engine</h1>
        
        
        <p class="article-description">Implementing LLM-powered dialectical reasoning for knowledge synthesis</p>
        
        
        
        <div class="progress-indicator">
            <div class="progress-bar">
                <div class="progress-fill" style="width: 66.68%"></div>
            </div>
        </div>
    </header>

    
    <aside class="article-toc">
        <h3>Table of Contents</h3>
        <nav id="TableOfContents">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#beyond-vector-averaging-true-dialectical-synthesis">Beyond Vector Averaging: True Dialectical Synthesis</a></li>
    <li><a href="#core-synthesis-infrastructure">Core Synthesis Infrastructure</a>
      <ul>
        <li></li>
        <li><a href="#from-paper-to-code-mathematical-metrics">From Paper to Code: Mathematical Metrics</a></li>
        <li><a href="#advanced-agent-action-guided-narrative-exploration">Advanced Agent Action: Guided Narrative Exploration</a></li>
      </ul>
    </li>
    <li><a href="#making-it-concrete-visualizing-the-sno-latent-space">Making it Concrete: Visualizing the SNO Latent Space</a></li>
  </ul>
</nav>
        </nav>
    </aside>

    
    <div class="article-content">
        <div class="guide-header">
    <a href="/" class="home-link">‚Üê Back to GTCode.com Homepage</a>
</div>
<h1 id="chapter-4-generative-synthesis-engine">Chapter 4: Generative Synthesis Engine</h1>
<h2 id="beyond-vector-averaging-true-dialectical-synthesis">Beyond Vector Averaging: True Dialectical Synthesis</h2>
<p>CNS 2.0&rsquo;s Generative Synthesis Engine models synthesis as an act of creative, reasoned generation through dialectical argumentation. The engine operates through four key stages:</p>
<ol>
<li><strong>Chiral Pair Selection</strong> - Identifying productive conflicts</li>
<li><strong>Dialectical Prompt Construction</strong> - Preserving argumentative structure</li>
<li><strong>Generative Synthesis</strong> - LLM-powered reasoning</li>
<li><strong>Candidate Evaluation</strong> - Quality assessment and refinement</li>
</ol>
<p>Let&rsquo;s implement each component to create a system capable of genuine knowledge synthesis.</p>
<h2 id="core-synthesis-infrastructure">Core Synthesis Infrastructure</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Generative Synthesis Engine Implementation
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">=========================================
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">LLM-powered dialectical reasoning for knowledge synthesis
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Tuple, Optional, Any, Set
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> dataclasses <span style="color:#f92672">import</span> dataclass
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> enum <span style="color:#f92672">import</span> Enum
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> abc <span style="color:#f92672">import</span> ABC, abstractmethod
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Import FAISS for scalable ANN-based pair finding</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> faiss
</span></span><span style="display:flex;"><span>    HAS_FAISS <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ImportError</span>:
</span></span><span style="display:flex;"><span>    HAS_FAISS <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Warning: faiss library not found. ChiralPairDetector will be inefficient.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)
</span></span><span style="display:flex;"><span>logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@dataclass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChiralPair</span>:
</span></span><span style="display:flex;"><span>    sno_a: StructuredNarrativeObject
</span></span><span style="display:flex;"><span>    sno_b: StructuredNarrativeObject
</span></span><span style="display:flex;"><span>    chirality_score: float
</span></span><span style="display:flex;"><span>    entanglement_score: float
</span></span><span style="display:flex;"><span>    synthesis_potential: float
</span></span><span style="display:flex;"><span>    conflict_points: List[str]
</span></span><span style="display:flex;"><span>    shared_evidence: Set[str]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ... (Other dataclasses and Enums from original file) ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RelationalMetrics</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_cosine_similarity</span>(v1: np<span style="color:#f92672">.</span>ndarray, v2: np<span style="color:#f92672">.</span>ndarray) <span style="color:#f92672">-&gt;</span> float:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Helper for cosine similarity.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>dot(v1, v2) <span style="color:#f92672">/</span> (np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(v1) <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(v2))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chirality_score</span>(sno_a: StructuredNarrativeObject, sno_b: StructuredNarrativeObject) <span style="color:#f92672">-&gt;</span> float:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> sno_a<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> sno_b<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> sno_a<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> sno_b<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>        cos_sim <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>_cosine_similarity(sno_a<span style="color:#f92672">.</span>hypothesis_embedding, sno_b<span style="color:#f92672">.</span>hypothesis_embedding)
</span></span><span style="display:flex;"><span>        opposition <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> cos_sim
</span></span><span style="display:flex;"><span>        trust_product <span style="color:#f92672">=</span> sno_a<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">*</span> sno_b<span style="color:#f92672">.</span>trust_score
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> opposition <span style="color:#f92672">*</span> trust_product
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">evidential_entanglement</span>(sno_a: StructuredNarrativeObject, sno_b: StructuredNarrativeObject) <span style="color:#f92672">-&gt;</span> Tuple[float, Set[str]]:
</span></span><span style="display:flex;"><span>        evidence_a <span style="color:#f92672">=</span> {e<span style="color:#f92672">.</span>source_id <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> sno_a<span style="color:#f92672">.</span>evidence_set}
</span></span><span style="display:flex;"><span>        evidence_b <span style="color:#f92672">=</span> {e<span style="color:#f92672">.</span>source_id <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> sno_b<span style="color:#f92672">.</span>evidence_set}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> evidence_a <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> evidence_b:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0.0</span>, set()
</span></span><span style="display:flex;"><span>        intersection <span style="color:#f92672">=</span> evidence_a<span style="color:#f92672">.</span>intersection(evidence_b)
</span></span><span style="display:flex;"><span>        union <span style="color:#f92672">=</span> evidence_a<span style="color:#f92672">.</span>union(evidence_b)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> len(intersection) <span style="color:#f92672">/</span> len(union) <span style="color:#66d9ef">if</span> union <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0.0</span>, intersection
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@staticmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">synthesis_potential</span>(chirality: float, entanglement: float) <span style="color:#f92672">-&gt;</span> float:
</span></span><span style="display:flex;"><span>        geometric_mean <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(chirality <span style="color:#f92672">*</span> entanglement)
</span></span><span style="display:flex;"><span>        balance_bonus <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> abs(chirality <span style="color:#f92672">-</span> entanglement)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> geometric_mean <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1.0</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.2</span> <span style="color:#f92672">*</span> balance_bonus)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#### Deconstructing the Synthesis Potential Metric</span>
</span></span><span style="display:flex;"><span>The <span style="color:#960050;background-color:#1e0010">`</span>synthesis_potential<span style="color:#960050;background-color:#1e0010">`</span> function <span style="color:#f92672">is</span> designed to identify the <span style="color:#f92672">*</span>most productive<span style="color:#f92672">*</span> pairs <span style="color:#66d9ef">for</span> synthesis<span style="color:#f92672">.</span> It<span style="color:#e6db74">&#39;s not enough for two narratives to be merely contradictory; they should be contradictory *and* balanced in their conflict. The formula accomplishes this in two parts:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1.</span>  <span style="color:#f92672">**</span><span style="color:#960050;background-color:#1e0010">`</span>geometric_mean <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(chirality <span style="color:#f92672">*</span> entanglement)<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">**</span>: We use the geometric mean instead of a simple average<span style="color:#f92672">.</span> The geometric mean heavily penalizes pairs where one score <span style="color:#f92672">is</span> very low<span style="color:#f92672">.</span> For example, <span style="color:#66d9ef">if</span> <span style="color:#960050;background-color:#1e0010">`</span>chirality<span style="color:#960050;background-color:#1e0010">`</span> <span style="color:#f92672">is</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">0.9</span><span style="color:#960050;background-color:#1e0010">`</span> but <span style="color:#960050;background-color:#1e0010">`</span>entanglement<span style="color:#960050;background-color:#1e0010">`</span> <span style="color:#f92672">is</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">0.1</span><span style="color:#960050;background-color:#1e0010">`</span>, their arithmetic average <span style="color:#f92672">is</span> <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">0.5</span><span style="color:#960050;background-color:#1e0010">`</span>, but their geometric mean <span style="color:#f92672">is</span> only <span style="color:#960050;background-color:#1e0010">`</span><span style="color:#ae81ff">0.3</span><span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">.</span> This ensures that the system prioritizes pairs that are <span style="color:#f92672">*</span>both<span style="color:#f92672">*</span> highly chiral <span style="color:#f92672">and</span> highly entangled, preventing it <span style="color:#f92672">from</span> wasting time on pairs that are strong <span style="color:#f92672">in</span> one aspect but weak <span style="color:#f92672">in</span> the other<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2.</span>  <span style="color:#f92672">**</span><span style="color:#960050;background-color:#1e0010">`</span>balance_bonus <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> abs(chirality <span style="color:#f92672">-</span> entanglement)<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">**</span>: This term rewards pairs where the chirality <span style="color:#f92672">and</span> entanglement scores are close to each other<span style="color:#f92672">.</span> For example, a pair <span style="color:#66d9ef">with</span> <span style="color:#960050;background-color:#1e0010">`</span>(chirality<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>, entanglement<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>)<span style="color:#960050;background-color:#1e0010">`</span> <span style="color:#f92672">is</span> considered more <span style="color:#e6db74">&#34;balanced&#34;</span> <span style="color:#f92672">and</span> thus more promising than a pair <span style="color:#66d9ef">with</span> <span style="color:#960050;background-color:#1e0010">`</span>(chirality<span style="color:#f92672">=</span><span style="color:#ae81ff">0.9</span>, entanglement<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)<span style="color:#960050;background-color:#1e0010">`</span><span style="color:#f92672">.</span> The bonus encourages the system to focus on well<span style="color:#f92672">-</span>proportioned conflicts<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The final score combines these two ideas, prioritizing balanced pairs that have high scores on both of the core relational metrics<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Scalable Pair Selection with Robust Conflict Detection</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">**</span>From Paper to Code: Scalable Pair Finding <span style="color:#66d9ef">with</span> ANN<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> The paper (Section <span style="color:#ae81ff">3.3</span>) mandates an efficient, two<span style="color:#f92672">-</span>step process <span style="color:#66d9ef">for</span> finding synthesis candidates: first, use an Approximate Nearest Neighbor (ANN) index to pre<span style="color:#f92672">-</span>filter pairs, then calculate more intensive scores<span style="color:#f92672">.</span> Our <span style="color:#960050;background-color:#1e0010">`</span>ChiralPairDetector<span style="color:#960050;background-color:#1e0010">`</span> uses the <span style="color:#960050;background-color:#1e0010">`</span>faiss<span style="color:#960050;background-color:#1e0010">`</span> library <span style="color:#66d9ef">for</span> this, ensuring scalability<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>This updated <span style="color:#960050;background-color:#1e0010">`</span>ChiralPairDetector<span style="color:#960050;background-color:#1e0010">`</span> features a significantly improved <span style="color:#960050;background-color:#1e0010">`</span>_identify_conflicts<span style="color:#960050;background-color:#1e0010">`</span> method<span style="color:#f92672">.</span> Instead of relying on brittle keyword matching, it now uses <span style="color:#f92672">**</span>semantic similarity<span style="color:#f92672">**</span> on claim embeddings to find nuanced points of disagreement, making our conflict detection far more robust<span style="color:#f92672">.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">```</span>python
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChiralPairDetector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;Scalable SNO pair detection using ANN search and semantic conflict identification.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, 
</span></span><span style="display:flex;"><span>                 embedding_model, <span style="color:#75715e"># Pass in the embedding model for on-the-fly computations</span>
</span></span><span style="display:flex;"><span>                 chirality_threshold: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>,
</span></span><span style="display:flex;"><span>                 entanglement_threshold: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.3</span>,
</span></span><span style="display:flex;"><span>                 synthesis_threshold: float <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                 k_neighbors: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>embedding_model <span style="color:#f92672">=</span> embedding_model
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>chirality_threshold <span style="color:#f92672">=</span> chirality_threshold
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>entanglement_threshold <span style="color:#f92672">=</span> entanglement_threshold
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>synthesis_threshold <span style="color:#f92672">=</span> synthesis_threshold
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>k_neighbors <span style="color:#f92672">=</span> min(k_neighbors, len(sno_population) <span style="color:#66d9ef">if</span> sno_population <span style="color:#66d9ef">else</span> k_neighbors)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> HAS_FAISS:
</span></span><span style="display:flex;"><span>            logger<span style="color:#f92672">.</span>warning(<span style="color:#e6db74">&#34;FAISS not installed. Falling back to O(n¬≤) pair detection.&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find_chiral_pairs</span>(self, sno_population: List[StructuredNarrativeObject], max_pairs: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>) <span style="color:#f92672">-&gt;</span> List[ChiralPair]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Finds the most promising chiral pairs for synthesis.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        Uses FAISS for efficient search if available, otherwise falls back to a brute-force O(n^2) search.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(sno_population) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Ensure all necessary embeddings are pre-computed.</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>_embed_all_claims(sno_population)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> HAS_FAISS:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_find_pairs_faiss(sno_population, max_pairs)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>_find_pairs_brute_force(sno_population, max_pairs)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_find_pairs_faiss</span>(self, sno_population: List[StructuredNarrativeObject], max_pairs: int) <span style="color:#f92672">-&gt;</span> List[ChiralPair]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Finds candidate pairs efficiently using a FAISS index.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        sno_map <span style="color:#f92672">=</span> {i: sno <span style="color:#66d9ef">for</span> i, sno <span style="color:#f92672">in</span> enumerate(sno_population) <span style="color:#66d9ef">if</span> sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(sno_map) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>: <span style="color:#66d9ef">return</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        embeddings <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#66d9ef">for</span> sno <span style="color:#f92672">in</span> sno_map<span style="color:#f92672">.</span>values()])<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float32&#39;</span>)
</span></span><span style="display:flex;"><span>        dimension <span style="color:#f92672">=</span> embeddings<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        index <span style="color:#f92672">=</span> faiss<span style="color:#f92672">.</span>IndexFlatL2(dimension)
</span></span><span style="display:flex;"><span>        index<span style="color:#f92672">.</span>add(embeddings)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Search for k nearest neighbors for each vector.</span>
</span></span><span style="display:flex;"><span>        distances, indices <span style="color:#f92672">=</span> index<span style="color:#f92672">.</span>search(embeddings, self<span style="color:#f92672">.</span>k_neighbors)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        processed_pairs <span style="color:#f92672">=</span> set()
</span></span><span style="display:flex;"><span>        candidate_pairs <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, sno_a <span style="color:#f92672">in</span> sno_map<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j_idx, neighbor_sno_idx <span style="color:#f92672">in</span> enumerate(indices[i]):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> neighbor_sno_idx: <span style="color:#66d9ef">continue</span> <span style="color:#75715e"># Skip self-comparison</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                pair_key <span style="color:#f92672">=</span> tuple(sorted((sno_a<span style="color:#f92672">.</span>sno_id, sno_map[neighbor_sno_idx]<span style="color:#f92672">.</span>sno_id)))
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> pair_key <span style="color:#f92672">in</span> processed_pairs: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>                processed_pairs<span style="color:#f92672">.</span>add(pair_key)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                sno_b <span style="color:#f92672">=</span> sno_map[neighbor_sno_idx]
</span></span><span style="display:flex;"><span>                chirality <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>chirality_score(sno_a, sno_b)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> chirality <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>chirality_threshold:
</span></span><span style="display:flex;"><span>                    entanglement, shared_evidence <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>evidential_entanglement(sno_a, sno_b)
</span></span><span style="display:flex;"><span>                    potential <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>synthesis_potential(chirality, entanglement)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> entanglement <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>entanglement_threshold <span style="color:#f92672">and</span> potential <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>synthesis_threshold:
</span></span><span style="display:flex;"><span>                        conflict_points <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_identify_conflicts_semantically(sno_a, sno_b)
</span></span><span style="display:flex;"><span>                        candidate_pairs<span style="color:#f92672">.</span>append(ChiralPair(sno_a, sno_b, chirality, entanglement, potential, conflict_points, shared_evidence))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        candidate_pairs<span style="color:#f92672">.</span>sort(key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> p: p<span style="color:#f92672">.</span>synthesis_potential, reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> candidate_pairs[:max_pairs]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_find_pairs_brute_force</span>(self, sno_population: List[StructuredNarrativeObject], max_pairs: int) <span style="color:#f92672">-&gt;</span> List[ChiralPair]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Finds candidate pairs using a simple, O(n^2) brute-force search.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        candidate_pairs <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, sno_a <span style="color:#f92672">in</span> enumerate(sno_population):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j, sno_b <span style="color:#f92672">in</span> enumerate(sno_population):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&gt;=</span> j: <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                chirality <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>chirality_score(sno_a, sno_b)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> chirality <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>chirality_threshold:
</span></span><span style="display:flex;"><span>                    entanglement, shared_evidence <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>evidential_entanglement(sno_a, sno_b)
</span></span><span style="display:flex;"><span>                    potential <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>synthesis_potential(chirality, entanglement)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> entanglement <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>entanglement_threshold <span style="color:#f92672">and</span> potential <span style="color:#f92672">&gt;=</span> self<span style="color:#f92672">.</span>synthesis_threshold:
</span></span><span style="display:flex;"><span>                        conflict_points <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_identify_conflicts_semantically(sno_a, sno_b)
</span></span><span style="display:flex;"><span>                        candidate_pairs<span style="color:#f92672">.</span>append(ChiralPair(sno_a, sno_b, chirality, entanglement, potential, conflict_points, shared_evidence))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        candidate_pairs<span style="color:#f92672">.</span>sort(key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> p: p<span style="color:#f92672">.</span>synthesis_potential, reverse<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> candidate_pairs[:max_pairs]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_embed_all_claims</span>(self, sno_population: List[StructuredNarrativeObject]):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Utility to compute and cache claim embeddings for a population of SNOs.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> sno <span style="color:#f92672">in</span> sno_population:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Ensure central hypothesis is embedded</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                sno<span style="color:#f92672">.</span>compute_hypothesis_embedding(self<span style="color:#f92672">.</span>embedding_model)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Embed all sub-claims</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> node_id, data <span style="color:#f92672">in</span> sno<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>nodes(data<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>                claim_node <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;claim&#39;</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> claim_node <span style="color:#f92672">and</span> claim_node<span style="color:#f92672">.</span>embedding <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                    claim_node<span style="color:#f92672">.</span>embedding <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>embedding_model<span style="color:#f92672">.</span>encode(claim_node<span style="color:#f92672">.</span>content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_identify_conflicts_semantically</span>(self, sno_a: StructuredNarrativeObject, sno_b: StructuredNarrativeObject, threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>) <span style="color:#f92672">-&gt;</span> List[str]:
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;Identifies conflicts using semantic similarity of claim embeddings.&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        conflicts <span style="color:#f92672">=</span> [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Central hypothesis conflict: &#39;</span><span style="color:#e6db74">{</span>sno_a<span style="color:#f92672">.</span>central_hypothesis<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; vs &#39;</span><span style="color:#e6db74">{</span>sno_b<span style="color:#f92672">.</span>central_hypothesis<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>]
</span></span><span style="display:flex;"><span>        claims_a <span style="color:#f92672">=</span> [data[<span style="color:#e6db74">&#39;claim&#39;</span>] <span style="color:#66d9ef">for</span> _, data <span style="color:#f92672">in</span> sno_a<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>nodes(data<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>) <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;claim&#39;</span> <span style="color:#f92672">in</span> data <span style="color:#f92672">and</span> data[<span style="color:#e6db74">&#39;claim&#39;</span>]<span style="color:#f92672">.</span>embedding <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span>        claims_b <span style="color:#f92672">=</span> [data[<span style="color:#e6db74">&#39;claim&#39;</span>] <span style="color:#66d9ef">for</span> _, data <span style="color:#f92672">in</span> sno_b<span style="color:#f92672">.</span>reasoning_graph<span style="color:#f92672">.</span>nodes(data<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>) <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;claim&#39;</span> <span style="color:#f92672">in</span> data <span style="color:#f92672">and</span> data[<span style="color:#e6db74">&#39;claim&#39;</span>]<span style="color:#f92672">.</span>embedding <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ca <span style="color:#f92672">in</span> claims_a:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> cb <span style="color:#f92672">in</span> claims_b:
</span></span><span style="display:flex;"><span>                similarity <span style="color:#f92672">=</span> RelationalMetrics<span style="color:#f92672">.</span>_cosine_similarity(ca<span style="color:#f92672">.</span>embedding, cb<span style="color:#f92672">.</span>embedding)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> similarity <span style="color:#f92672">&lt;</span> threshold:
</span></span><span style="display:flex;"><span>                    conflicts<span style="color:#f92672">.</span>append(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Potential claim conflict (similarity </span><span style="color:#e6db74">{</span>similarity<span style="color:#e6db74">:</span><span style="color:#e6db74">.2f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">): &#39;</span><span style="color:#e6db74">{</span>ca<span style="color:#f92672">.</span>content<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; vs &#39;</span><span style="color:#e6db74">{</span>cb<span style="color:#f92672">.</span>content<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> conflicts[:<span style="color:#ae81ff">5</span>] <span style="color:#75715e"># Limit for brevity</span>
</span></span></code></pre></div><h4 id="a-note-on-semantic-conflict-detection">A Note on Semantic Conflict Detection</h4>
<p>Our <code>_identify_conflicts_semantically</code> method uses cosine similarity to find disagreements between sub-claims, but it&rsquo;s crucial to understand the nuances of this approach. Cosine similarity produces a score between -1 and 1:</p>
<ul>
<li><strong>Score near 1</strong>: The claims are semantically very similar.</li>
<li><strong>Score near 0</strong>: The claims are semantically unrelated (orthogonal). For example, &ldquo;The sky is blue&rdquo; and &ldquo;Interest rates are rising&rdquo;.</li>
<li><strong>Score near -1</strong>: The claims are semantically opposite or contradictory. For example, &ldquo;The battery is safe&rdquo; and &ldquo;The battery is dangerous&rdquo;.</li>
</ul>
<p>Our current implementation uses a simple threshold (<code>&lt; 0.2</code>) which correctly identifies claims that are either unrelated or in direct opposition. However, for a more precise and powerful system, this can be refined. Here are two advanced strategies:</p>
<ol>
<li>
<p><strong>Focus on Opposition with a Negative Threshold</strong>: To find only the most direct conflicts, you could change the condition to check for a negative similarity score (e.g., <code>similarity &lt; -0.2</code>). This would focus the synthesis engine on resolving clear-cut contradictions rather than just disconnected statements. The trade-off is potentially missing more subtle forms of disagreement.</p>
</li>
<li>
<p><strong>Use a Natural Language Inference (NLI) Model</strong>: The most robust method is to leverage the same technology used in our <code>GroundingCritic</code>. For each pair of claims, you can query an NLI model:</p>
<ul>
<li><strong>Premise</strong>: Claim A&rsquo;s content.</li>
<li><strong>Hypothesis</strong>: Claim B&rsquo;s content.
The NLI model will output probabilities for three labels: <code>entailment</code>, <code>neutral</code>, and <code>contradiction</code>. If the <code>contradiction</code> probability is high, you have found a strong point of conflict. This is more computationally expensive than cosine similarity but provides a much more explicit and reliable signal of genuine logical conflict, allowing the synthesis engine to focus its efforts on the most meaningful disagreements.</li>
</ul>
</li>
</ol>
<h3 id="from-paper-to-code-mathematical-metrics">From Paper to Code: Mathematical Metrics</h3>
<p>The <code>RelationalMetrics</code> class implements the crucial formulas from Section 3.2 of the paper, allowing the system to identify the most <em>productive</em> conflicts for synthesis. The <code>CScore</code> (Chirality) and <code>EScore</code> (Entanglement) are direct translations of the paper&rsquo;s mathematical definitions into code, forming the analytical foundation of the synthesis engine.</p>
<h3 id="advanced-agent-action-guided-narrative-exploration">Advanced Agent Action: Guided Narrative Exploration</h3>
<p>(This section remains the same as the original file, describing latent space targeting.)</p>
<h2 id="making-it-concrete-visualizing-the-sno-latent-space">Making it Concrete: Visualizing the SNO Latent Space</h2>
<p>The concepts of &ldquo;latent space,&rdquo; &ldquo;chirality,&rdquo; and &ldquo;conceptual distance&rdquo; are powerful but abstract. To make them intuitive, we can visualize the high-dimensional hypothesis embeddings in 2D space. This is a powerful diagnostic and exploratory tool.</p>
<p>We can achieve this using <code>scikit-learn</code> for t-SNE (a dimensionality reduction technique) and <code>matplotlib</code> for plotting.</p>
<p><strong>Note:</strong> You may need to install these libraries: <code>pip install scikit-learn matplotlib</code></p>
<p>Here‚Äôs a function that takes a list of SNOs and generates a plot of their conceptual relationships:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#66d9ef">as</span> plt
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sklearn.manifold <span style="color:#f92672">import</span> TSNE
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> List
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">visualize_sno_population</span>(sno_population: List[StructuredNarrativeObject]):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Creates a 2D visualization of the SNO population&#39;s hypothesis embeddings using t-SNE.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    embeddings <span style="color:#f92672">=</span> [sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#66d9ef">for</span> sno <span style="color:#f92672">in</span> sno_population <span style="color:#66d9ef">if</span> sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(embeddings) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Not enough SNOs with embeddings to visualize.&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Ensure all embeddings are in a single numpy array</span>
</span></span><span style="display:flex;"><span>    embedding_matrix <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(embeddings)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Use t-SNE to reduce to 2 dimensions</span>
</span></span><span style="display:flex;"><span>    tsne <span style="color:#f92672">=</span> TSNE(n_components<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, perplexity<span style="color:#f92672">=</span>max(min(len(embeddings) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">30</span>), <span style="color:#ae81ff">1</span>), random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>)
</span></span><span style="display:flex;"><span>    embeddings_2d <span style="color:#f92672">=</span> tsne<span style="color:#f92672">.</span>fit_transform(embedding_matrix)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Extract trust scores for color-coding the plot</span>
</span></span><span style="display:flex;"><span>    trust_scores <span style="color:#f92672">=</span> [sno<span style="color:#f92672">.</span>trust_score <span style="color:#f92672">or</span> <span style="color:#ae81ff">0.0</span> <span style="color:#66d9ef">for</span> sno <span style="color:#f92672">in</span> sno_population <span style="color:#66d9ef">if</span> sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Create the scatter plot</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">8</span>))
</span></span><span style="display:flex;"><span>    scatter <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>scatter(
</span></span><span style="display:flex;"><span>        embeddings_2d[:, <span style="color:#ae81ff">0</span>],
</span></span><span style="display:flex;"><span>        embeddings_2d[:, <span style="color:#ae81ff">1</span>],
</span></span><span style="display:flex;"><span>        c<span style="color:#f92672">=</span>trust_scores,
</span></span><span style="display:flex;"><span>        cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;viridis&#39;</span>,
</span></span><span style="display:flex;"><span>        alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>,
</span></span><span style="display:flex;"><span>        s<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span> <span style="color:#75715e"># size of points</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Add labels and titles</span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;t-SNE Visualization of SNO Latent Space&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;t-SNE Dimension 1&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;t-SNE Dimension 2&#39;</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>colorbar(scatter, label<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Trust Score&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Annotate points with SNO IDs for clarity</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, sno <span style="color:#f92672">in</span> enumerate(sno_population):
</span></span><span style="display:flex;"><span>         <span style="color:#66d9ef">if</span> sno<span style="color:#f92672">.</span>hypothesis_embedding <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            plt<span style="color:#f92672">.</span>annotate(sno<span style="color:#f92672">.</span>sno_id[:<span style="color:#ae81ff">8</span>], (embeddings_2d[i, <span style="color:#ae81ff">0</span>], embeddings_2d[i, <span style="color:#ae81ff">1</span>]), alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>grid(<span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    plt<span style="color:#f92672">.</span>show()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Example Usage (assuming you have a populated and evaluated list of SNOs):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># visualize_sno_population(my_sno_list)</span>
</span></span></code></pre></div><p>This visualization allows you to literally <em>see</em> the structure of your knowledge base. Clusters of points represent dominant theories, while distant outliers are novel or fringe ideas. A &ldquo;chiral pair&rdquo; would appear as two points, often far from each other, but both with high trust scores (e.g., bright colors in our plot). This tool transforms the abstract mathematics of CNS 2.0 into a concrete, explorable map of ideas.</p>

    </div>

    
    <nav class="article-nav">
        <div class="nav-previous">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-5-system-integration/" class="nav-link prev-link">
                    <i data-feather="arrow-right"></i>
                    <div class="nav-text">
                        <span class="nav-label">Next</span>
                        <span class="nav-title">Chapter 5: System Integration</span>
                    </div>
                </a>
            
        </div>
        
        <div class="nav-next">
            
                <a href="/guides/building-cns-2.0-developers-guide/chapter-3-critic-pipeline/" class="nav-link next-link">
                    <div class="nav-text">
                        <span class="nav-label">Previous</span>
                        <span class="nav-title">Chapter 3: Multi-Component Critic Pipeline</span>
                    </div>
                    <i data-feather="arrow-left"></i>
                </a>
            
        </div>
    </nav>

    
    <aside class="chapter-summary">
        <h3>Chapter Summary</h3>
        <div class="summary-content">
            
                <p>Creating LLM-powered dialectical reasoning for knowledge synthesis.</p>
                <ul>
                    <li>Chiral pair detection algorithms</li>
                    <li>Synthesis strategy determination</li>
                    <li>Generative synthesis implementation</li>
                </ul>
            
        </div>
    </aside>
</article>

            </div>
        </main>

        
        <footer class="site-footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-text">
                        <p>&copy; 2025 <a href="https://GTCode.com/" class="footer-link">GTCode.com</a>. Educational content for CNS 2.0 implementation.</p>
                        <p>Based on <a target="_blank" 
                               rel="noopener noreferrer" href="/papers/ResearchProposal-ChiralNarrativeSynthesis_20250617_3.pdf" class="footer-link">CNS 2.0: A Practical Blueprint for Chiral Narrative Synthesis</a> research paper. (20250617 Version 3)</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    
    <script src="/js/navigation.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    
    
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body, {delimiters: [{left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}]});"></script>
    
    <script>
        
        if (window.feather) feather.replace();
    </script>
</body>
</html>
